"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,n,i){var s,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(a=(r<3?s(a):r>3?s(e,n,a):s(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(t,e){return function(n,i){e(n,i,t)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateActivityService=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),Observable_1=require("rxjs/Observable"),activity_schema_services_1=require("./activity.schema.services"),CreateActivityService=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.http=n,i.value=function(t,e){switch(t){case"Connection Name":return Observable_1.Observable.create(function(t){var e=[];wi_contrib_1.WiContributionUtils.getConnections(i.http,"Salesforce").subscribe(function(n){n.forEach(function(t){for(var n=0;n<t.settings.length;n++)if("name"===t.settings[n].name){e.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(t),name:t.settings[n].value});break}}),t.next(e)})});case"Object Name":var n=e.getField("Connection Name").value;return n?Observable_1.Observable.create(function(t){var e=[];wi_contrib_1.WiContributionUtils.getConnection(i.http,n).map(function(t){return t}).subscribe(function(n){for(var s,r={},a="",c="",o="Production",u="",l="",_="",g=!1,v="",b=3,p="",f=0;f<n.settings.length;f++)"authType"===n.settings[f].name&&(c=n.settings[f].value),"WI_STUDIO_OAUTH_CONNECTOR_INFO"===n.settings[f].name&&(r=n.settings[f].value.startsWith("{")?JSON.parse(n.settings[f].value):JSON.parse(atob(n.settings[f].value))),"apiVersion"===n.settings[f].name&&(a=n.settings[f].value),"environment"===n.settings[f].name&&(o=n.settings[f].value),"clientId"===n.settings[f].name&&(u=n.settings[f].value),"clientSecret"===n.settings[f].name&&(l=n.settings[f].value),"jwt"===n.settings[f].name&&(_=n.settings[f].value),"generateJwt"===n.settings[f].name&&(g=n.settings[f].value),"customOAuth2Credentials"===n.settings[f].name&&(s=n.settings[f].value),"subject"===n.settings[f].name&&(v=n.settings[f].value),"jwtExpiry"===n.settings[f].name&&(b=n.settings[f].value),"clientKey"===n.settings[f].name&&""!==n.settings[f].value&&(p=n.settings[f].value.content,p=atob(p.split("base64,")[1]));wi_contrib_1.WiContributionUtils.getAppConfig(i.http).subscribe(function(t){t.deployment===wi_contrib_1.APP_DEPLOYMENT.ON_PREMISE&&(s=!0)}),r.api_version=a,r.client_id=u,r.client_secret=l,r.jwt=_,r.customOAuth2Credentials=s,r.subject=v,r.jwtExpiry=b,r.clientPrivateKey=p,"OAuth 2.0 JWT Bearer Flow"===c||s&&""!==r.client_secret&&void 0!==r.client_id||!s?activity_schema_services_1.SFSchemaServices.getObjects(i.http,r,o,c,g).subscribe(function(n){n.forEach(function(t){e.push(t.name)}),t.next(e)},function(e){t.error("Failed to get SF objects due to: "+JSON.stringify(e))},function(){t.complete()}):t.next(null)})}):null;case"input":var s=e.getField("Connection Name").value,r=e.getField("Object Name").value;return s&&r?Observable_1.Observable.create(function(t){null!=r&&wi_contrib_1.WiContributionUtils.getConnection(i.http,s).map(function(t){return t}).subscribe(function(e){for(var n,s={},a="",c="",o="Production",u="",l="",_="",g=!1,v="",b=3,p="",f=0;f<e.settings.length;f++)"authType"===e.settings[f].name&&(c=e.settings[f].value),"WI_STUDIO_OAUTH_CONNECTOR_INFO"===e.settings[f].name&&(s=e.settings[f].value.startsWith("{")?JSON.parse(e.settings[f].value):JSON.parse(atob(e.settings[f].value))),"apiVersion"===e.settings[f].name&&(a=e.settings[f].value),"environment"===e.settings[f].name&&(o=e.settings[f].value),"clientId"===e.settings[f].name&&(u=e.settings[f].value),"clientSecret"===e.settings[f].name&&(l=e.settings[f].value),"jwt"===e.settings[f].name&&(_=e.settings[f].value),"generateJwt"===e.settings[f].name&&(g=e.settings[f].value),"customOAuth2Credentials"===e.settings[f].name&&(n=e.settings[f].value),"subject"===e.settings[f].name&&(v=e.settings[f].value),"jwtExpiry"===e.settings[f].name&&(b=e.settings[f].value),"clientKey"===e.settings[f].name&&""!==e.settings[f].value&&(p=e.settings[f].value.content,p=atob(p.split("base64,")[1]));wi_contrib_1.WiContributionUtils.getAppConfig(i.http).subscribe(function(t){t.deployment===wi_contrib_1.APP_DEPLOYMENT.ON_PREMISE&&(n=!0)}),s.api_version=a,s.client_id=u,s.client_secret=l,s.jwt=_,s.customOAuth2Credentials=n,s.subject=v,s.jwtExpiry=b,s.clientPrivateKey=p,"OAuth 2.0 JWT Bearer Flow"===c||n&&""!==s.client_secret&&void 0!==s.client_id||!n?activity_schema_services_1.SFSchemaServices.describeObject(i.http,s,r,!1,!1,o,c,g).subscribe(function(e){t.next(JSON.stringify(e))},function(e){t.error("Failed to get schema due to: "+JSON.stringify(e))},function(){t.complete()}):t.next(null)})}):null;default:return null}},i.validate=function(t,e){return null},i}return __extends(e,t),e=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],e)}(wi_contrib_1.WiServiceHandlerContribution);exports.CreateActivityService=CreateActivityService;
//# sourceMappingURL=activity.js.map
