"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,n,i){var s,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(a=(r<3?s(a):r>3?s(e,n,a):s(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.QueryActivityService=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),Observable_1=require("rxjs/Observable"),activity_schema_services_1=require("./activity.schema.services"),QueryActivityService=function(t){function e(e){var n=t.call(this)||this;return n.http=e,n.value=function(t,e){switch(t){case"Connection Name":return Observable_1.Observable.create(function(t){var e=[];wi_contrib_1.WiContributionUtils.getConnections(n.http,"Salesforce").subscribe(function(n){n.forEach(function(t){for(var n=0;n<t.settings.length;n++)if("name"===t.settings[n].name){e.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(t),name:t.settings[n].value});break}}),t.next(e)})});case"Object Name":var i=e.getField("Connection Name").value;return i?Observable_1.Observable.create(function(t){var e=[];wi_contrib_1.WiContributionUtils.getConnection(n.http,i).map(function(t){return t}).subscribe(function(i){for(var s={},r="",a="",c="Production",o="",u="",l=!1,_=!1,g="",v="",b=3,p="",f=0;f<i.settings.length;f++)"authType"===i.settings[f].name&&(a=i.settings[f].value),"WI_STUDIO_OAUTH_CONNECTOR_INFO"===i.settings[f].name&&(s=i.settings[f].value.startsWith("{")?JSON.parse(i.settings[f].value):JSON.parse(atob(i.settings[f].value))),"apiVersion"===i.settings[f].name&&(r=i.settings[f].value),"environment"===i.settings[f].name&&(c=i.settings[f].value),"clientSecret"===i.settings[f].name&&(o=i.settings[f].value),"jwt"===i.settings[f].name&&(u=i.settings[f].value),"customOAuth2Credentials"===i.settings[f].name&&(l=i.settings[f].value),"clientId"===i.settings[f].name&&(g=i.settings[f].value),"generateJwt"===i.settings[f].name&&(_=i.settings[f].value),"subject"===i.settings[f].name&&(v=i.settings[f].value),"jwtExpiry"===i.settings[f].name&&(b=i.settings[f].value),"clientKey"===i.settings[f].name&&""!==i.settings[f].value&&(p=i.settings[f].value.content,p=atob(p.split("base64,")[1]));wi_contrib_1.WiContributionUtils.getAppConfig(n.http).subscribe(function(t){t.deployment===wi_contrib_1.APP_DEPLOYMENT.ON_PREMISE&&(l=!0)}),s.api_version=r,s.client_secret=o,s.jwt=u,s.customOAuth2Credentials=l,s.client_id=g,s.subject=v,s.jwtExpiry=b,s.clientPrivateKey=p,"OAuth 2.0 JWT Bearer Flow"===a||l&&""!==s.client_secret&&void 0!==s.client_id||!l?activity_schema_services_1.SFSchemaServices.getObjects(n.http,s,c,a,_).subscribe(function(n){n.forEach(function(t){e.push(t.name)}),t.next(e)},function(e){t.error("Failed to get SF objects due to: "+JSON.stringify(e))},function(){t.complete()}):t.next(null)})}):null;case"output":var s=e.getField("Connection Name").value,r=e.getField("Object Name").value;return s&&r?Observable_1.Observable.create(function(t){null!=r&&wi_contrib_1.WiContributionUtils.getConnection(n.http,s).map(function(t){return t}).subscribe(function(e){for(var i={},s="",a="",c="Production",o="",u="",l=!1,_=!1,g="",v="",b=3,p="",f=0;f<e.settings.length;f++)"authType"===e.settings[f].name&&(a=e.settings[f].value),"WI_STUDIO_OAUTH_CONNECTOR_INFO"===e.settings[f].name&&(i=e.settings[f].value.startsWith("{")?JSON.parse(e.settings[f].value):JSON.parse(atob(e.settings[f].value))),"apiVersion"===e.settings[f].name&&(s=e.settings[f].value),"environment"===e.settings[f].name&&(c=e.settings[f].value),"clientSecret"===e.settings[f].name&&(o=e.settings[f].value),"jwt"===e.settings[f].name&&(u=e.settings[f].value),"customOAuth2Credentials"===e.settings[f].name&&(l=e.settings[f].value),"clientId"===e.settings[f].name&&(g=e.settings[f].value),"generateJwt"===e.settings[f].name&&(_=e.settings[f].value),"subject"===e.settings[f].name&&(v=e.settings[f].value),"jwtExpiry"===e.settings[f].name&&(b=e.settings[f].value),"clientKey"===e.settings[f].name&&""!==e.settings[f].value&&(p=e.settings[f].value.content,p=atob(p.split("base64,")[1]));wi_contrib_1.WiContributionUtils.getAppConfig(n.http).subscribe(function(t){t.deployment===wi_contrib_1.APP_DEPLOYMENT.ON_PREMISE&&(l=!0)}),i.api_version=s,i.client_secret=o,i.jwt=u,i.customOAuth2Credentials=l,i.client_id=g,i.subject=v,i.jwtExpiry=b,i.clientPrivateKey=p,"OAuth 2.0 JWT Bearer Flow"===a||l&&""!==i.client_secret&&void 0!==i.client_id||!l?activity_schema_services_1.SFSchemaServices.describeObject(n.http,i,r,!0,!1,c,a,_).subscribe(function(e){t.next(JSON.stringify(e))},function(e){t.error("Failed to get schema due to: "+JSON.stringify(e))},function(){t.complete()}):t.next(null)})}):null;default:return null}},n.validate=function(t,e){return null},n}return __extends(e,t),e=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[http_1.Http])],e)}(wi_contrib_1.WiServiceHandlerContribution);exports.QueryActivityService=QueryActivityService;
//# sourceMappingURL=activity.js.map
