"use strict";var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,l=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(l=(a<3?i(l):a>3?i(t,n,l):i(t,n))||l);return a>3&&l&&Object.defineProperty(t,n,l),l},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IbmMqSubscriberContribModule=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),Observable_1=require("rxjs/Observable"),lodash=require("lodash"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),IbmMqSubscriberContribModule=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.injector=t,i.http=n,i.contribModelService=r,i.mqmdSchema='{"MsgType": "string", "MsgId": "string","CorrelId":"string","Encoding": 0,"CodedCharSetId":0,"Format":"string","Priority":0, "BackoutCount": 0 ,"ReplyToQ":"string","ReplyToQmgr":"string","UserIdentifier":"string","AccountingToken":"string","ApplIdentityData":"string","PutApplType":0,"PutApplName":"string","PutDate":"string","PutTime":"string","ApplOriginData":"string"}',i.value=function(e,t){switch(e){case"Connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(i.http,i.category).subscribe(function(n){n.forEach(function(e){for(var n=0;n<e.settings.length;n++)if("name"===e.settings[n].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[n].value});break}}),e.next(t)})})}return null},i.validate=function(e,t){var n=t.getField("valueType").value.toString(),r=t.getField("durable").value;switch(e){case"MessageJson":return wi_contrib_1.ValidationResult.newValidationResult().setVisible("JSON"===n);case"Message":return wi_contrib_1.ValidationResult.newValidationResult().setVisible("String"===n);case"durablename":return wi_contrib_1.ValidationResult.newValidationResult().setVisible(r);default:return null}},i.action=function(e,t){var n=i.getModelService(),r=wi_contrib_1.CreateFlowActionResult.newActionResult();if(t.settings&&t.settings.length>0){var a=t.getField("Connection"),l=t.getField("valueType"),o=t.getField("MessageJson"),s=t.getField("MessageProperties");if(a&&a.value){var u=n.createTriggerElement("IBM-MQ/subscriber");if(u&&u.settings&&u.settings.length>0)for(var c=0;c<u.settings.length;c++)"clientconfirm"===u.settings[c].name?u.settings[c].value=t.getField("clientconfirm").value:"pollinginterval"===u.settings[c].name&&(u.settings[c].value=t.getField("pollinginterval").value);if(u&&u.handler&&u.handler.settings&&u.handler.settings.length>0)for(c=0;c<u.handler.settings.length;c++)"Connection"===u.handler.settings[c].name?u.handler.settings[c].value=a.value:"topic"===u.handler.settings[c].name?u.handler.settings[c].value=t.getField("topic").value:"dynamictopic"===u.handler.settings[c].name?u.handler.settings[c].value=t.getField("dynamictopic").value:"durable"===u.handler.settings[c].name?u.handler.settings[c].value=t.getField("durable").value:"durablename"===u.handler.settings[c].name?u.handler.settings[c].value=t.getField("durablename").value:"newpubsonly"===u.handler.settings[c].name?u.handler.settings[c].value=t.getField("newpubsonly").value:"valueType"===u.handler.settings[c].name&&(u.handler.settings[c].value=l.value);for(c=0;c<u.outputs.length;c++)"MQMD"===u.outputs[c].name?u.outputs[c].value={value:i.mqmdSchema,metadata:""}:"MessageProperties"===u.outputs[c].name&&void 0!==s&&null!=s.value?u.outputs[c].value=s.value:"Message"===u.outputs[c].name&&("String"===l.value?u.outputs[c].value={value:'{ "String": "string" }',metadata:""}:u.outputs[c].value={value:o.value.value,metadata:""});var g=n.createFlow(t.getFlowName(),t.getFlowDescription());r=r.addTriggerFlowMapping(lodash.cloneDeep(u),lodash.cloneDeep(g))}}return wi_contrib_1.ActionResult.newActionResult().setSuccess(!0).setResult(r)},i.category="IBM-MQ",i}return __extends(t,e),t.prototype.getContextVar=function(e,t){return e.getField(t)?void 0===e.getField(t).value?"":e.getField(t).value:""},t.prototype.getPropertiesSchema=function(e){if(""===e.getField("propertiesSchema").value)return"";var t=e.getField("propertiesSchema").value;try{for(var n=JSON.parse(t.value),r="{",i=0,a=n;i<a.length;i++){var l=a[i];r+='"'+l.propertyName+'":"'+l.type+'",'}return r=r.substr(0,r.length-1),r+="}"}catch(e){return console.log(e),""}},t=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http,wi_contrib_1.WiContribModelService])],t)}(wi_contrib_1.WiServiceHandlerContribution);exports.IbmMqSubscriberContribModule=IbmMqSubscriberContribModule;
//# sourceMappingURL=trigger.js.map
