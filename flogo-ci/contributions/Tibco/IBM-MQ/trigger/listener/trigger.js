"use strict";var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IbmMqListenerContribModule=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),Observable_1=require("rxjs/Observable"),lodash=require("lodash"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),IbmMqListenerContribModule=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.injector=t,i.http=n,i.contribModelService=r,i.mqmdSchema='{"MsgType": "string", "MsgId": "string","CorrelId":"string","Encoding": 0,"CodedCharSetId":0,"Format":"string","Priority":0, "BackoutCount": 0 ,"ReplyToQ":"string","ReplyToQmgr":"string","UserIdentifier":"string","AccountingToken":"string","ApplIdentityData":"string","PutApplType":0,"PutApplName":"string","PutDate":"string","PutTime":"string","ApplOriginData":"string"}',i.value=function(e,t){switch(e){case"Connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(i.http,i.category).subscribe(function(n){n.forEach(function(e){for(var n=0;n<e.settings.length;n++)if("name"===e.settings[n].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[n].value});break}}),e.next(t)})})}return null},i.validate=function(e,t){var n=t.getField("valueType").value.toString();switch(e){case"MessageJson":return wi_contrib_1.ValidationResult.newValidationResult().setVisible("JSON"===n);case"Message":return wi_contrib_1.ValidationResult.newValidationResult().setVisible("String"===n);default:return null}},i.action=function(e,t){var n=i.getModelService(),r=wi_contrib_1.CreateFlowActionResult.newActionResult();if(t.settings&&t.settings.length>0){var o=t.getField("Connection"),a=t.getField("queue"),s=t.getField("valueType"),l=t.getField("MessageJson"),u=t.getField("MessageProperties");if(o&&o.value){var c=n.createTriggerElement("IBM-MQ/listener");if(c&&c.settings&&c.settings.length>0)for(var g=0;g<c.settings.length;g++)"clientconfirm"===c.settings[g].name?c.settings[g].value=t.getField("clientconfirm").value:"pollinginterval"===c.settings[g].name&&(c.settings[g].value=t.getField("pollinginterval").value);if(c&&c.handler&&c.handler.settings&&c.handler.settings.length>0)for(g=0;g<c.handler.settings.length;g++)"Connection"===c.handler.settings[g].name?c.handler.settings[g].value=o.value:"queue"===c.handler.settings[g].name?c.handler.settings[g].value=a.value:"valueType"===c.handler.settings[g].name&&(c.handler.settings[g].value=s.value);for(g=0;g<c.outputs.length;g++)"MQMD"===c.outputs[g].name?c.outputs[g].value={value:i.mqmdSchema,metadata:""}:"MessageProperties"===c.outputs[g].name&&void 0!==u&&null!=u.value?c.outputs[g].value=u.value:"Message"===c.outputs[g].name&&("String"===s.value?c.outputs[g].value={value:'{ "String": "string" }',metadata:""}:c.outputs[g].value={value:l.value.value,metadata:""});var p=n.createFlow(t.getFlowName(),t.getFlowDescription());r=r.addTriggerFlowMapping(lodash.cloneDeep(c),lodash.cloneDeep(p))}}return wi_contrib_1.ActionResult.newActionResult().setSuccess(!0).setResult(r)},i.category="IBM-MQ",i}return __extends(t,e),t.prototype.getContextVar=function(e,t){return e.getField(t)?void 0===e.getField(t).value?"":e.getField(t).value:""},t.prototype.getPropertiesSchema=function(e){if(""===e.getField("propertiesSchema").value)return"";var t=e.getField("propertiesSchema").value;try{for(var n=JSON.parse(t.value),r="{",i=0,o=n;i<o.length;i++){var a=o[i];r+='"'+a.propertyName+'":"'+a.type+'",'}return r=r.substr(0,r.length-1),r+="}"}catch(e){return console.log(e),""}},t=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http,wi_contrib_1.WiContribModelService])],t)}(wi_contrib_1.WiServiceHandlerContribution);exports.IbmMqListenerContribModule=IbmMqListenerContribModule;
//# sourceMappingURL=trigger.js.map
