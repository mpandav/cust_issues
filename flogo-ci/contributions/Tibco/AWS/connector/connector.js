"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),validation_1=require("wi-studio/common/models/validation"),contrib_1=require("wi-studio/common/models/contrib"),Observable_1=require("rxjs/Observable"),AWSConnectorService=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.http=n,i.value=function(e,t){return null},i.validate=function(e,t){if("endpoint"===e){var n=validation_1.ValidationResult.newValidationResult(),o=!1;return i.getContextVar(t,"customEndpoint")&&(o=i.getContextVar(t,"customEndpoint")),n.setVisible(o),n}return"accessKey"===e||"secretKey"===e||"sessionToken"===e||"assumeRole"===e?validation_1.ValidationResult.newValidationResult().setVisible("AWS Credentials"===i.getContextVar(t,"authenticationType")):"roleArn"===e||"roleSessionName"===e||"externalId"===e||"expirationDuration"===e?Observable_1.Observable.create(function(n){wi_contrib_1.WiContributionUtils.getAppConfig(i.http).subscribe(function(i){for(var o=!1,r="",a=0,s=0,l=t.settings;s<l.length;s++){var c=l[s];"assumeRole"===c.name?o=c.value:"roleSessionName"===c.name?r=c.value:"expirationDuration"===c.name&&(a=c.value)}var u=validation_1.ValidationResult.newValidationResult();!0===o?(u.setVisible(!0),"roleSessionName"===e?r.length<2&&u.setError("Role Session Name Error","Role Session Name must have length greather than or equal to 2"):"expirationDuration"===e&&a&&a<900&&u.setError("Expiration Duration Error","Expiration Duration must bigger than 900 seconds")):u.setVisible(!1),n.next(u)},function(e){n.next(validation_1.ValidationResult.newValidationResult().setVisible(!1))},function(){return n.complete()})}):null},i.action=function(e,t){return"Save"===e||"Save Connector"===e?Observable_1.Observable.create(function(e){for(var n="",o=0;o<t.settings.length;o++)if("name"===t.settings[o].name){n=t.settings[o].value;break}var r=!1;wi_contrib_1.WiContributionUtils.getConnections(i.http,"AWS").subscribe(function(i){for(var o=0,a=i;o<a.length;o++)for(var s=a[o],l=0;l<s.settings.length;l++){if("name"===s.settings[l].name)if(s.settings[l].value===n&&wi_contrib_1.WiContributionUtils.getUniqueId(s)!==wi_contrib_1.WiContributionUtils.getUniqueId(t)){r=!0;break}}if(r)e.next(contrib_1.ActionResult.newActionResult().setSuccess(!1).setResult(new validation_1.ValidationError("BASIC-1000","Connection name already exist !!!"))),e.complete();else{var c={context:t,authType:wi_contrib_1.AUTHENTICATION_TYPE.BASIC,authData:{}};e.next(contrib_1.ActionResult.newActionResult().setResult(c))}})}):null},i}return __extends(t,e),t.prototype.getContextVar=function(e,t){var n=e.getField(t);return null!=n&&n.value?n.value:null},t}(wi_contrib_1.WiServiceHandlerContribution);AWSConnectorService=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],AWSConnectorService),exports.AWSConnectorService=AWSConnectorService;
//# sourceMappingURL=connector.js.map
