"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateActivityService=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),Observable_1=require("rxjs/Observable"),LIST_ID="ListId",CAMPAIGNS="Campaigns",CreateActivityService=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.http=r,n.value=function(e,t){switch(e){case"Connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(n.http,"Mailchimp").subscribe(function(r){r.forEach(function(e){for(var r=0;r<e.settings.length;r++)if("name"===e.settings[r].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[r].value});break}}),e.next(t)})});case"ListId":var r=t.getField("Connection").value;return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnection(n.http,r).map(function(e){return e}).subscribe(function(r){for(var i,o,a=0,s=r.settings;a<s.length;a++){var c=s[a];if("WI_STUDIO_OAUTH_CONNECTOR_INFO"===c.name){var p=c.value,l=JSON.parse(p);i=l.api_endpoint,o=l.access_token;break}}var _=i+"/lists";wi_contrib_1.WiProxyCORSUtils.createRequest(n.http,_).addMethod("GET").addHeader("Authorization","Bearer "+o).send().subscribe(function(r){if(200===r.status)for(var n=0,i=r.json().lists;n<i.length;n++){var o=i[n];t.push({unique_id:o.id,name:o.name})}e.next(t)})})});case"input":return Observable_1.Observable.create(function(e){switch(t.getField("Resource").value){case CAMPAIGNS:e.next(JSON.stringify(INPUT_CAMPAIGNS));break;default:e.next(null)}});case"output":var i=t.getField("Resource").value;return Observable_1.Observable.create(function(e){switch(i){case CAMPAIGNS:e.next(JSON.stringify(OUTPUT_CAMPAIGNS));break;default:e.next(null)}})}},n.validate=function(e,t){return null},n}return __extends(t,e),t=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],t)}(wi_contrib_1.WiServiceHandlerContribution);exports.CreateActivityService=CreateActivityService;var INPUT_CAMPAIGNS={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{fields:{type:"array",items:{type:"string"}},exclude_fields:{type:"array",items:{type:"string"}},count:{type:"integer"},offset:{type:"integer"},type:{type:"string"},status:{type:"string"},before_send_time:{type:"string"},since_send_time:{type:"string"},before_create_time:{type:"string"},since_create_time:{type:"string"},list_id:{type:"string"},folder_id:{type:"string"},sort_field:{type:"string"},sort_dir:{type:"string"}}},OUTPUT_CAMPAIGNS={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{campaigns:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},create_time:{type:"string"},archive_url:{type:"string"},status:{type:"string"},emails_sent:{type:"integer"},send_time:{type:"string"},content_type:{type:"string"},recipients:{type:"object",properties:{list_id:{type:"string"},segment_text:{type:"string"}}},settings:{type:"object",properties:{subject_line:{type:"string"},title:{type:"string"},from_name:{type:"string"},reply_to:{type:"string"},use_conversation:{type:"boolean"},to_name:{type:"string"},folder_id:{type:"integer"},authenticate:{type:"boolean"},auto_footer:{type:"boolean"},inline_css:{type:"boolean"},auto_tweet:{type:"boolean"},fb_comments:{type:"boolean"},timewarp:{type:"boolean"},template_id:{type:"integer"},drag_and_drop:{type:"boolean"}}},tracking:{type:"object",properties:{opens:{type:"boolean"},html_clicks:{type:"boolean"},text_clicks:{type:"boolean"},goal_tracking:{type:"boolean"},ecomm360:{type:"boolean"},google_analytics:{type:"boolean"},clicktale:{type:"string"}}},delivery_status:{type:"object",properties:{enabled:{type:"boolean"}}},_links:{type:"array",items:{type:"object",properties:{rel:{type:"string"},href:{type:"string"},method:{type:"string"},targetSchema:{type:"string"},schema:{type:"string"}}}}}}},total_items:{type:"integer"},_links:{type:"array",items:{type:"object",properties:{rel:{type:"string"},href:{type:"string"},method:{type:"string"},targetSchema:{type:"string"}}}}}};
//# sourceMappingURL=activity.js.map
