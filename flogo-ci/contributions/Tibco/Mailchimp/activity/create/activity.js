"use strict";var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var p=e.length-1;p>=0;p--)(n=e[p])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateActivityService=void 0;var http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),validation_1=require("wi-studio/common/models/validation"),Observable_1=require("rxjs/Observable"),LIST_ID="ListId",LIST="List",SUBSCRIBER="Member",VERSION_PATH="/3.0",CreateActivityService=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.http=i,r.value=function(e,t){switch(e){case"Connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(r.http,"Mailchimp").subscribe(function(i){i.forEach(function(e){for(var i=0;i<e.settings.length;i++)if("name"===e.settings[i].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[i].value});break}}),e.next(t)})});case"ListId":var i=t.getField("Connection").value;return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnection(r.http,i).map(function(e){return e}).subscribe(function(i){for(var n,s,a=0,p=i.settings;a<p.length;a++){var o=p[a];if("WI_STUDIO_OAUTH_CONNECTOR_INFO"===o.name){var c=o.value,_=JSON.parse(c);n=_.api_endpoint,s=_.access_token;break}}var y=n+VERSION_PATH+"/lists";wi_contrib_1.WiProxyCORSUtils.createRequest(r.http,y).addMethod("GET").addHeader("Authorization","Bearer "+s).send().subscribe(function(i){if(200===i.status)for(var r=0,n=i.json().lists;r<n.length;r++){var s=n[r];t.push({unique_id:s.id,name:s.name})}e.next(t)})})});case"input":return Observable_1.Observable.create(function(e){switch(t.getField("Resource").value){case LIST:e.next(JSON.stringify(INPUT_SCHEMA_LIST));break;case SUBSCRIBER:e.next(JSON.stringify(INPUT_SCHEMA_MEMBER));break;default:e.next(null)}});case"output":var n=t.getField("Resource").value;return Observable_1.Observable.create(function(e){switch(n){case LIST:e.next(JSON.stringify(OUTPUT_SCHEMA_LIST));break;case SUBSCRIBER:e.next(JSON.stringify(OUTPUT_SCHEMA_MEMBER));break;default:e.next(null)}})}},r.validate=function(e,t){if(e===LIST_ID)return t.getField("Resource").value===SUBSCRIBER?validation_1.ValidationResult.newValidationResult().setVisible(!0):validation_1.ValidationResult.newValidationResult().setVisible(!1)},r}return __extends(t,e),t=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],t)}(wi_contrib_1.WiServiceHandlerContribution);exports.CreateActivityService=CreateActivityService;var INPUT_SCHEMA_LIST={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{name:{type:"string"},contact:{type:"object",properties:{company:{type:"string"},address1:{type:"string"},address2:{type:"string"},city:{type:"string"},state:{type:"string"},zip:{type:"string"},country:{type:"string"},phone:{type:"string"}},required:["company","address1","city","state","zip","country"]},permission_reminder:{type:"string"},use_archive_bar:{type:"boolean"},campaign_defaults:{type:"object",properties:{from_name:{type:"string"},from_email:{type:"string"},subject:{type:"string"},language:{type:"string"}},required:["from_name","from_email","subject","language"]},notify_on_subscribe:{type:"string"},notify_on_unsubscribe:{type:"string"},email_type_option:{type:"boolean"},visibility:{type:"string"}},required:["name","contact","permission_reminder","campaign_defaults","email_type_option"]},INPUT_SCHEMA_MEMBER={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{email_address:{type:"string"},email_type:{type:"string"},status:{type:"string"},merge_fields:{type:"string"},interests:{type:"string"},language:{type:"string"},vip:{type:"string"},location:{type:"object",properties:{latitude:{type:"integer"},longitude:{type:"integer"}}},ip_signup:{type:"string"},timestamp_signup:{type:"string"},ip_opt:{type:"string"},timestamp_opt:{type:"string"}},required:["email_address","status"]},OUTPUT_SCHEMA_LIST={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{id:{type:"string"},name:{type:"string"},contact:{type:"object",properties:{company:{type:"string"},address1:{type:"string"},address2:{type:"string"},city:{type:"string"},state:{type:"string"},zip:{type:"string"},country:{type:"string"},phone:{type:"string"}}},permission_reminder:{type:"string"},use_archive_bar:{type:"boolean"},campaign_defaults:{type:"object",properties:{from_name:{type:"string"},from_email:{type:"string"},subject:{type:"string"},language:{type:"string"}}},notify_on_subscribe:{type:"string"},notify_on_unsubscribe:{type:"string"},date_created:{type:"string"},list_rating:{type:"integer"},email_type_option:{type:"boolean"},subscribe_url_short:{type:"string"},subscribe_url_long:{type:"string"},beamer_address:{type:"string"},visibility:{type:"string"},modules:{type:"array"},stats:{type:"object",properties:{member_count:{type:"integer"},unsubscribe_count:{type:"integer"},cleaned_count:{type:"integer"},member_count_since_send:{type:"integer"},unsubscribe_count_since_send:{type:"integer"},cleaned_count_since_send:{type:"integer"},campaign_count:{type:"integer"},campaign_last_sent:{type:"string"},merge_field_count:{type:"integer"},avg_sub_rate:{type:"integer"},avg_unsub_rate:{type:"integer"},target_sub_rate:{type:"integer"},open_rate:{type:"integer"},click_rate:{type:"integer"},last_sub_date:{type:"string"},last_unsub_date:{type:"string"}}},_links:{type:"array",items:{type:"object",properties:{rel:{type:"string"},href:{type:"string"},method:{type:"string"},targetSchema:{type:"string"}}}}}},OUTPUT_SCHEMA_MEMBER={$id:"http://example.com/example.json",type:"object",definitions:{},$schema:"http://json-schema.org/draft-07/schema#",properties:{id:{type:"string"},email_address:{type:"string"},unique_email_id:{type:"string"},email_type:{type:"string"},status:{type:"string"},status_if_new:{type:"string"},merge_fields:{type:"object",properties:{FNAME:{type:"string"},LNAME:{type:"string"}}},interests:{type:"object",properties:{"9143cf3bd1":{type:"boolean"},"3a2a927344":{type:"boolean"},f9c8f5f0ff:{type:"boolean"},f231b09abc:{type:"boolean"},bd6e66465f:{type:"boolean"}}},stats:{type:"object",properties:{avg_open_rate:{type:"integer"},avg_click_rate:{type:"integer"}}},ip_signup:{type:"string"},timestamp_signup:{type:"string"},ip_opt:{type:"string"},timestamp_opt:{type:"string"},member_rating:{type:"integer"},last_changed:{type:"string"},language:{type:"string"},vip:{type:"boolean"},email_client:{type:"string"},location:{type:"object",properties:{latitude:{type:"integer"},longitude:{type:"integer"},gmtoff:{type:"integer"},dstoff:{type:"integer"},country_code:{type:"string"},timezone:{type:"string"}}},list_id:{type:"string"},_links:{type:"array",items:{type:"object",properties:{rel:{type:"string"},href:{type:"string"},method:{type:"string"},targetSchema:{type:"string"}}}}}};
//# sourceMappingURL=activity.js.map
