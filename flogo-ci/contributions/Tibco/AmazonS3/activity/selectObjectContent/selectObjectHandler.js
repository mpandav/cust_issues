"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var n,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,r,o):n(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),Observable_1=require("rxjs/Observable"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),InputSerializationList=[{unique_id:"csv",name:"CSV"},{unique_id:"json",name:"JSON"},{unique_id:"parquet",name:"Parquet"}],CompressionTypeList=[{unique_id:"gzip",name:"GZIP"},{unique_id:"bzip2",name:"BZIP2"},{unique_id:"none",name:"None"}],OutputSerializationList=[{unique_id:"csv",name:"CSV"},{unique_id:"json",name:"JSON"}],ErrorSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{code:{type:"string"},message:{type:"string"},statusCode:{type:"integer"},requestId:{type:"string"}}},ISS_CSV={$schema:"http://json-schema.org/draft-04/schema#",type:"object",inputSettingsOnly:!0,required:[],properties:{AllowQuotedRecordDelimiter:{type:"boolean"},Comments:{type:"string"},FieldDelimiter:{type:"string"},FileHeaderInfo:{type:"string"},QuoteCharacter:{type:"string"},QuoteEscapeCharacter:{type:"string"},RecordDelimiter:{type:"string"}}},ISS_JSON={$schema:"http://json-schema.org/draft-04/schema#",type:"object",inputSettingsOnly:!0,required:[],properties:{Type:{type:"string"}}},InputSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["Bucket","Key","Expression","ExpressionType","InputSerialization"],properties:{Bucket:{type:"string"},Key:{type:"string"},Expression:{type:"string"},ExpressionType:{type:"string"},InputSerialization:{type:"object"},OutputSerialization:{type:"object"},RequestProgress:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:[],properties:{Enabled:{type:"boolean"}}},SSECustomerAlgorithm:{type:"string"},SSECustomerKey:{type:"string"},SSECustomerKeyMD5:{type:"string"},ScanRange:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:[],properties:{Start:{type:"number"},End:{type:"number"}}}}},OSS_CSV={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:[],properties:{OutputType:{type:"string"},DestinationFilePath:{type:"string"},FieldDelimiter:{type:"string"},QuoteCharacter:{type:"string"},QuoteEscapeCharacter:{type:"string"},QuoteFields:{type:"string"},RecordDelimiter:{type:"string"}}},OSS_JSON={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:[],properties:{OutputType:{type:"string"},DestinationFilePath:{type:"string"},RecordDelimiter:{type:"string"}}},selectObjectHandler=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.injector=t,i.http=r,i.value=function(e,t){var r=t.getField("connection").value,n=t.getField("inputSerialization").value,a=t.getField("outputSerialization").value;switch(e){case"connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(i.http,"AWS").subscribe(function(r){r.forEach(function(e){for(var r=0;r<e.settings.length;r++)if("name"===e.settings[r].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[r].value});break}}),e.next(t)})});case"inputSerialization":if(r)return InputSerializationList;break;case"compressionType":if(r)return CompressionTypeList;break;case"outputSerialization":if(r)return OutputSerializationList;break;case"input":if(r)return JSON.stringify(i.inputSchemaProvider(n,a));break;case"error":if(r)return JSON.stringify(ErrorSchema)}},i.validate=function(e,t){wi_contrib_1.ValidationResult.newValidationResult();return null},i.action=function(e,t){return Observable_1.Observable.create(function(e){var t=wi_contrib_1.ActionResult.newActionResult();e.next(t)})},i}return __extends(t,e),t.prototype.inputSchemaProvider=function(e,t){switch(e){case"csv":return(r=JSON.parse(JSON.stringify(InputSchema))).properties.InputSerialization=ISS_CSV,this.getSchemaWithOutputSerialization(t,r);case"json":return(r=JSON.parse(JSON.stringify(InputSchema))).properties.InputSerialization=ISS_JSON,this.getSchemaWithOutputSerialization(t,r);case"parquet":var r;return delete(r=JSON.parse(JSON.stringify(InputSchema))).properties.InputSerialization,this.getSchemaWithOutputSerialization(t,r)}},t.prototype.getSchemaWithOutputSerialization=function(e,t){switch(e){case"csv":return t.properties.OutputSerialization=OSS_CSV,t;case"json":return t.properties.OutputSerialization=OSS_JSON,t}},t}(wi_contrib_1.WiServiceHandlerContribution);selectObjectHandler=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http])],selectObjectHandler),exports.selectObjectHandler=selectObjectHandler;
//# sourceMappingURL=selectObjectHandler.js.map
