"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var activity_jsonschema_1=require("./activity.jsonschema"),Rx_1=require("rxjs/Rx");require("rxjs/Rx");var SMALLINT="SMALLINT",INTEGER="INTEGER",BIGINT="BIGINT",INT="INT",INT2="INT2",INT4="INT4",INT8="INT8",BIT="BIT",TINYINT="TINYINT",NUMERIC="NUMERIC",DECIMAL="DECIMAL",REAL="REAL",FLOAT="FLOAT",FLOAT4="FLOAT4",FLOAT8="FLOAT8",DOUBLE="DOUBLE",BOOLEAN="BOOLEAN",CHAR="CHAR",BPCHAR="BPCHAR",NCHAR="NCHAR",CHARACTER="CHARACTER",VARCHAR="VARCHAR",TEXT="TEXT",MEDIUMTEXT="MEDIUMTEXT",LONGTEXT="LONGTEXT",DATE="DATE",TIMESTAMP="TIMESTAMP",TIMESTAMPTZ="TIMESTAMPTZ",POINT="POINT",ANYENUM="ANYENUM",STRUCT="STRUCT",QueryMetadata=function(){return function(e,t,r,a){this.ok=e,this.message=t,this.query=r,this.fields=a}}();exports.QueryMetadata=QueryMetadata;var Fields=function(){return function(e,t,r,a){this.FieldName=e,this.Type=t,this.Direction=r,this.isEditable=a,this.isEditable=!1}}();exports.Fields=Fields;var Connection=function(){function e(){this.dbserviceURL="/dbservicego/dbservice/procedurecolumns",this.queries=[]}return e.toJsonSchema=function(e){var t={};switch(e.Type){case SMALLINT:case INTEGER:case BIGINT:case INT:case INT2:case INT4:case INT8:case TINYINT:t=activity_jsonschema_1.JsonSchema.Types.integerType();break;case DOUBLE:case DECIMAL:case NUMERIC:case FLOAT:case FLOAT4:case FLOAT8:case REAL:t=activity_jsonschema_1.JsonSchema.Types.numberType();break;case BIT:case BOOLEAN:t=activity_jsonschema_1.JsonSchema.Types.boolType();break;case VARCHAR:case TEXT:case MEDIUMTEXT:case LONGTEXT:case CHAR:case BPCHAR:case ANYENUM:case POINT:case NCHAR:case CHARACTER:t=activity_jsonschema_1.JsonSchema.Types.stringType();break;case DATE:case TIMESTAMPTZ:t=activity_jsonschema_1.JsonSchema.Types.dateType();break;case TIMESTAMP:t=activity_jsonschema_1.JsonSchema.Types.timeType();break;case STRUCT:t=activity_jsonschema_1.JsonSchema.Types.arrayType();break;default:t=activity_jsonschema_1.JsonSchema.Types.stringType()}return t},e.prototype.fetchQueryMetadata=function(t,r,a,s,i,n){var c=this;return Rx_1.Observable.of(t).filter(function(e){return function(e){return!!e&&e.trim().length>0}(e)&&e.replace(/(\r\n|\n|\r)/gm,"")}).map(function(e){return Object.assign({queryString:e,queryURL:c.dbserviceURL,connection:c})}).mergeMap(function(e){return i(s,e,r,a)}).mergeMap(function(r){return e.createFields(t,Object.values(r.data.columns),n)})},e.createFields=function(e,t,r){var a=function(e){return!!e&&e.trim().length>0},s=t;return Rx_1.Observable.from(s).reduce(function(e,t){if(t){var r={FieldName:a(t.FieldName)?t.FieldName:t.colName,Type:a(t.Type)?t.Type:t.dataTypeName,Direction:a(t.Direction)?t.Direction:t.paramType,isEditable:!1};e.fields.push(r)}return e},{ok:!0,query:e,fields:[]})},e.getConnection=function(t){var r=new e;return Rx_1.Observable.from(t).reduce(function(e,t){return e[t.name]=t.value,e},r)},e.getOutputSchema=function(t){var r,a=this,s=activity_jsonschema_1.JsonSchema.Types.rootObject();return Rx_1.Observable.from(t).filter(function(e){return a.isOutputDirection(e.Direction)}).reduce(function(t,a){return"RETURNVALUE"===a.Direction||"INOUT"===a.Direction?(t[a.FieldName]=e.toJsonSchema(a),"array"===t[a.FieldName].type&&(t[a.FieldName]=activity_jsonschema_1.JsonSchema.Types.arrayType()),r=a.FieldName):t[r].items.properties[a.FieldName]=e.toJsonSchema(a),t},s.properties).mergeMap(function(e){return console.log("rootObject value in Output schema ",JSON.stringify(s)),Rx_1.Observable.of(s)})},e.isOutputDirection=function(e){switch(e){case"OUT":case"INOUT":case"RETURNVALUE":return!0;default:return!1}},e.isInputDirection=function(e){switch(e){case"IN":case"INOUT":return!0;default:return!1}},e.getInputSchema=function(t){var r=this,a=activity_jsonschema_1.JsonSchema.Types.rootObject(),s=activity_jsonschema_1.JsonSchema.Types.inputObject();a.properties.parameters=s.parameters;var i=a.properties.parameters.properties;return Rx_1.Observable.from(t).filter(function(e){return r.isInputDirection(e.Direction)}).reduce(function(t,r){return t[r.FieldName]=e.toJsonSchema(r),t},i).mergeMap(function(e){return Rx_1.Observable.of(a)})},e}();exports.Connection=Connection;
//# sourceMappingURL=connection.js.map
