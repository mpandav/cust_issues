"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Connection=void 0;var http_1=require("@angular/http"),rxjs_extensions_1=require("wi-studio/common/rxjs-extensions");require("wi-studio/common/rxjs-extensions");var schemadoc_1=require("./schemadoc"),Connection=function(){function e(){this.DocsMetadata=schemadoc_1.JsonSchema.Types.schemaDoc(),this.baseURL="https://management.azure.com/subscriptions/"}return e.getConnection=function(t){var n=new e;return rxjs_extensions_1.Observable.from(t.settings).reduce(function(e,t){return e[t.name]=t.value,e},n)},e.prototype.getEntityTypes=function(){return rxjs_extensions_1.Observable.of(this.DocsMetadata).map(function(e){return JSON.parse(e)}).map(function(e){return e.entityTypes})},e.prototype.getPathsForObject=function(e,t){return rxjs_extensions_1.Observable.of(this.DocsMetadata).map(function(e){return JSON.parse(e)}).mergeMap(function(n){return rxjs_extensions_1.Observable.from(Object.keys(n.paths)).filter(function(r){return r.startsWith("/"+e)&&n.paths[r][t]})})},e.prototype.getOperations=function(e,t){return rxjs_extensions_1.Observable.of(this.DocsMetadata).map(function(e){return JSON.parse(e)}).mergeMap(function(n){return rxjs_extensions_1.Observable.from(Object.keys(n.paths)).filter(function(r){return r.startsWith("/"+e)&&n.paths[r][t]}).reduce(function(e,r){return e.push(n.paths[r][t].action),e},[])})},e.prototype.getSubscriptions=function(e,t){var n=new http_1.Headers;n.append("Content-Type","application/x-www-form-urlencoded"),n.append("Accept","application/json"),n.append("Authorization","Bearer "+JSON.parse(t.WI_STUDIO_OAUTH_CONNECTOR_INFO).access_token);var r=new http_1.RequestOptions({headers:n});return e.http.get(t.baseURL+"?api-version=2016-06-01",r).switchMap(function(e){var t=e.json();return rxjs_extensions_1.Observable.of(t).map(function(e){return e}).mergeMap(function(e){return rxjs_extensions_1.Observable.from(Object.keys(e.value)).reduce(function(t,n){return t.push(e.value[n].subscriptionId),t},[])})})},e.prototype.getResourceGroups=function(e,t,n){var r=new http_1.Headers;r.append("Content-Type","application/x-www-form-urlencoded"),r.append("Accept","application/json"),r.append("Authorization","Bearer "+JSON.parse(t.WI_STUDIO_OAUTH_CONNECTOR_INFO).access_token);var s=new http_1.RequestOptions({headers:r});return e.http.get(t.baseURL+n+"/resourcegroups?api-version=2018-02-01",s).switchMap(function(e){var t=e.json();return rxjs_extensions_1.Observable.of(t).map(function(e){return e}).mergeMap(function(e){return rxjs_extensions_1.Observable.from(Object.keys(e.value)).reduce(function(t,n){return t.push(e.value[n].name),t},[])})})},e.prototype.getDatafactories=function(e,t,n,r){var s=new http_1.Headers;s.append("Content-Type","application/x-www-form-urlencoded"),s.append("Accept","application/json"),s.append("Authorization","Bearer "+JSON.parse(t.WI_STUDIO_OAUTH_CONNECTOR_INFO).access_token);var o=new http_1.RequestOptions({headers:s});return e.http.get(t.baseURL+n+"/resourceGroups/"+r+"/providers/Microsoft.DataFactory/factories?api-version=2018-06-01",o).switchMap(function(e){var t=e.json();return rxjs_extensions_1.Observable.of(t).map(function(e){return e}).mergeMap(function(e){return rxjs_extensions_1.Observable.from(Object.keys(e.value)).reduce(function(t,n){return t.push(e.value[n].name),t},[])})})},e.prototype.getTriggers=function(e,t,n,r,s){var o=new http_1.Headers;o.append("Content-Type","application/x-www-form-urlencoded"),o.append("Accept","application/json"),o.append("Authorization","Bearer "+JSON.parse(t.WI_STUDIO_OAUTH_CONNECTOR_INFO).access_token);var a=new http_1.RequestOptions({headers:o});return e.http.get(t.baseURL+n+"/resourceGroups/"+r+"/providers/Microsoft.DataFactory/factories/"+s+"/triggers?api-version=2018-06-01",a).switchMap(function(e){var t=e.json();return rxjs_extensions_1.Observable.of(t).map(function(e){return e}).mergeMap(function(e){return rxjs_extensions_1.Observable.from(Object.keys(e.value)).reduce(function(t,n){return t.push(e.value[n].name),t},[])})})},e.prototype.getSchemaForPath=function(e,t){return rxjs_extensions_1.Observable.of(this.DocsMetadata).map(function(e){return JSON.parse(e)}).mergeMap(function(n){return rxjs_extensions_1.Observable.from(Object.keys(n.paths)).filter(function(r){return r===e&&n.paths[r][t]}).map(function(e){return n.paths[e][t].schema})})},e.prototype.getSchemaForOperation=function(e,t){return rxjs_extensions_1.Observable.of(this.DocsMetadata).map(function(e){return JSON.parse(e)}).mergeMap(function(n){return rxjs_extensions_1.Observable.from(Object.keys(n.paths)).filter(function(r){return n.paths[r][t]&&n.paths[r][t].action===e}).map(function(e){return Object.assign(n.paths[e][t].schema,{path:e}),n.paths[e][t].schema})})},e}();exports.Connection=Connection;
//# sourceMappingURL=common.js.map
