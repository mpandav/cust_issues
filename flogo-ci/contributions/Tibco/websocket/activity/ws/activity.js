"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var n,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,r,o):n(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_extensions_1=require("wi-studio/common/rxjs-extensions"),http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),contributionHelper_1=require("wi-studio/common/util/contributionHelper"),WebsocketActivityContribution=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.http=r,i.value=function(e,t){console.log(e);var r=i.getContextVar(t,"format"),n=i.getContextVar(t,"jsonSchema");switch(e){case"message":return rxjs_extensions_1.Observable.of(i.getMessageSchemaString(r,n));case"pathParams":var a=t.getField("uri");return contributionHelper_1.ContributionHelper.extractJsonFromPath(a.value);default:return null}},i.validate=function(e,t){var r=i.getContextVar(t,"format"),n=i.getContextVar(t,"uri"),a=i.getContextVar(t,"allowInsecure"),o=n.indexOf("wss")>=0;switch(e){case"uri":return/(^(ws)(s)?:\/\/[^\s$.?#].[^\s]*\b([-a-zA-Z0-9()@:%_\+.~#?&\/\/=]*))/gi.test(n)?wi_contrib_1.ValidationResult.newValidationResult().setValid(!0).setVisible(!0):wi_contrib_1.ValidationResult.newValidationResult().setValid(!1).setError("WebSocketClient-00301","WebSocket URI is not in valid format").setVisible(!0);case"jsonSchema":return wi_contrib_1.ValidationResult.newValidationResult().setVisible("JSON"===r);case"allowInsecure":return wi_contrib_1.ValidationResult.newValidationResult().setVisible(o);case"caCert":return o?!a&&i.isFileVarVoid("caCert",t)?wi_contrib_1.ValidationResult.newValidationResult().setValid(!1).setError("WS-00203","TLS secure connection requires a CA Cert").setVisible(!0):wi_contrib_1.ValidationResult.newValidationResult().setValid(!0).setVisible(!a):wi_contrib_1.ValidationResult.newValidationResult().setValid(!0).setVisible(!1);case"queryParams":case"headers":return i.validateParametersByName(e,t);default:return null}},i.category="websocket",i}return __extends(t,e),t.prototype.validateParametersByName=function(e,t){return rxjs_extensions_1.Observable.create(function(r){var i=wi_contrib_1.ValidationResult.newValidationResult(),n=t.getField(e),a=[],o="",s={};try{s=JSON.parse(n.value)}catch(e){}for(var c=0,l=s;c<l.length;c++){var u=l[c];if(!u.parameterName){o="Parameter Name should not be empty",i.setError("WebSocketClient-1001",o),i.setValid(!1);break}for(var _=0,d=a;_<d.length;_++){if(d[_]===u.parameterName){o="Parameter Name '"+u.parameterName+"' already exists",i.setError("WebSocketClient-1001",o),i.setValid(!1);break}}a.push(u.parameterName)}r.next(i),r.complete()})},t.prototype.getMessageSchemaString=function(e,t){return"JSON"===e?t:""},t.prototype.getContextVar=function(e,t){return e.getField(t)&&void 0!==e.getField(t).value?e.getField(t).value:null},t.prototype.isFileVarVoid=function(e,t){var r=t.getField(e).value;if(null!==r){if(""===r.toString())return!0;if(""===r.content)return!0}return!1},t}(wi_contrib_1.WiServiceHandlerContribution);WebsocketActivityContribution=__decorate([core_1.Injectable(),wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],WebsocketActivityContribution),exports.WebsocketActivityContribution=WebsocketActivityContribution;
//# sourceMappingURL=activity.js.map
