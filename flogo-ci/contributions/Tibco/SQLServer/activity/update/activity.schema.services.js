"use strict";var __decorate=this&&this.__decorate||function(e,r,t,a){var c,s=arguments.length,i=s<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,t):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,a);else for(var n=e.length-1;n>=0;n--)(c=e[n])&&(i=(s<3?c(i):s>3?c(r,t,i):c(r,t))||i);return s>3&&i&&Object.defineProperty(r,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var activity_jsonschema_1=require("./activity.jsonschema"),Rx_1=require("rxjs/Rx");require("rxjs/Rx");var core_1=require("@angular/core"),SMALLINT="SMALLINT",INTEGER="INTEGER",BIGINT="BIGINT",INT="INT",INT2="INT2",INT4="INT4",INT8="INT8",NUMERIC="NUMERIC",DECIMAL="DECIMAL",REAL="REAL",FLOAT="FLOAT",FLOAT4="FLOAT4",FLOAT8="FLOAT8",DOUBLE="DOUBLE",BOOLEAN="BOOLEAN",CHAR="CHAR",BPCHAR="BPCHAR",NCHAR="NCHAR",CHARACTER="CHARACTER",VARCHAR="VARCHAR",DATE="DATE",TIMESTAMP="TIMESTAMP",TINYINT="TINYINT",TIMESTAMPTZ="TIMESTAMPTZ",QueryMetadata=function(){return function(e,r,t,a){this.ok=e,this.message=r,this.query=t,this.fields=a}}();exports.QueryMetadata=QueryMetadata;var Fields=function(){return function(e,r,t,a,c,s){this.FieldName=e,this.Type=r,this.Selected=t,this.Parameter=a,this.isEditable=c,this.Ordinal=s,this.isEditable=!1}}();exports.Fields=Fields;var SqlServerSchemaServices_1,SqlServerSchemaServices=SqlServerSchemaServices_1=function(){function e(){}return e.toJsonType=function(e){var r={};switch(e.Type){case SMALLINT:case INTEGER:case BIGINT:case INT:case INT2:case INT4:case INT8:case TINYINT:r=activity_jsonschema_1.JsonSchema.Types.integerType();break;case DOUBLE:case DECIMAL:case NUMERIC:case FLOAT:case FLOAT4:case FLOAT8:case REAL:r=activity_jsonschema_1.JsonSchema.Types.numberType();break;case BOOLEAN:r=activity_jsonschema_1.JsonSchema.Types.boolType();break;case VARCHAR:case CHAR:case BPCHAR:case NCHAR:case CHARACTER:r=activity_jsonschema_1.JsonSchema.Types.stringType();break;case DATE:case TIMESTAMPTZ:r=activity_jsonschema_1.JsonSchema.Types.dateType();break;case TIMESTAMP:r=activity_jsonschema_1.JsonSchema.Types.timeType();break;default:r=activity_jsonschema_1.JsonSchema.Types.stringType()}return r},e.prototype.fetchQueryMetadata=function(e,r,t,a,c){var s=this;return Rx_1.Observable.of(e).filter(function(e){return function(e){return!!e&&e.trim().length>0}(e)&&e.trim().replace(/(\r\n|\n|\r)/gm,"").endsWith(";")}).map(function(e){return Object.assign({queryString:e,queryURL:r,connection:s})}).mergeMap(function(e){return t(r,e)}).mergeMap(function(r){return SqlServerSchemaServices_1.createFields(e,r.Fields,a,c)})},e.sortFields=function(e,r){return e.Ordinal-r.Ordinal},e.createFields=function(e,r,t,a){var c=r;if(t&&a&&(c=c.concat(JSON.parse(a))),null!=c&&c.length>0){for(var s=[(c=c.filter(function(e){return null!=e}).sort(SqlServerSchemaServices_1.sortFields))[0]],i=1;i<c.length;i++){for(var n=!1,o=0;o<s.length;o++)if(i!==o&&c[i].FieldName===s[o].FieldName){n=!0;break}n||s.push(c[i])}c=s}return Rx_1.Observable.from(c).reduce(function(e,r){var a={FieldName:r.FieldName,Type:r.Type,Selected:r.Selected,Parameter:r.Parameter,isEditable:t,Ordinal:void 0===r.Ordinal?0:r.Ordinal};return r.Value&&(a.Value=r.Value),e.fields.push(a),e.fields.sort(SqlServerSchemaServices_1.sortFields),e},{ok:!0,query:e,fields:[]})},e.getConnection=function(e){var r=new SqlServerSchemaServices_1;return Rx_1.Observable.from(e).reduce(function(e,r){return e[r.name]=r.value,e},r)},e.getSchemaServices=function(e){var r=new SqlServerSchemaServices_1;return Rx_1.Observable.from(e).reduce(function(e,r){return e[r.name]=r.value,e},r)},e.prototype.getUpdateInputSchema=function(e){var r=activity_jsonschema_1.JsonSchema.Types.rootObject(),t=activity_jsonschema_1.JsonSchema.Types.inputObject();return r.properties.parameters=t.parameters,Rx_1.Observable.from(e).reduce(function(e,r){return!0!==r.Parameter&&"true"!==r.Parameter||(e.properties.parameters.properties[r.FieldName]=SqlServerSchemaServices_1.toJsonType(r)),e},r).mergeMap(function(e){return Rx_1.Observable.of(r)})},e}();SqlServerSchemaServices=SqlServerSchemaServices_1=__decorate([core_1.Injectable()],SqlServerSchemaServices),exports.SqlServerSchemaServices=SqlServerSchemaServices;
//# sourceMappingURL=activity.schema.services.js.map
