"use strict";var __decorate=this&&this.__decorate||function(e,r,t,a){var s,c=arguments.length,i=c<3?r:null===a?a=Object.getOwnPropertyDescriptor(r,t):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,a);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(i=(c<3?s(i):c>3?s(r,t,i):s(r,t))||i);return c>3&&i&&Object.defineProperty(r,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var activity_jsonschema_1=require("./activity.jsonschema");require("rxjs/Rx");var core_1=require("@angular/core"),Rx_1=require("rxjs/Rx"),SMALLINT="SMALLINT",INTEGER="INTEGER",BIGINT="BIGINT",INT="INT",INT2="INT2",INT4="INT4",INT8="INT8",NUMERIC="NUMERIC",DECIMAL="DECIMAL",REAL="REAL",FLOAT="FLOAT",FLOAT4="FLOAT4",FLOAT8="FLOAT8",DOUBLE="DOUBLE",BOOLEAN="BOOLEAN",CHAR="CHAR",BPCHAR="BPCHAR",NCHAR="NCHAR",CHARACTER="CHARACTER",VARCHAR="VARCHAR",DATE="DATE",TIMESTAMP="TIMESTAMP",TINYINT="TINYINT",TIMESTAMPTZ="TIMESTAMPTZ",QueryMetadata=function(){return function(e,r,t,a){this.ok=e,this.message=r,this.query=t,this.fields=a}}();exports.QueryMetadata=QueryMetadata;var Fields=function(){return function(e,r,t,a,s,c){this.FieldName=e,this.Type=r,this.Selected=t,this.Parameter=a,this.isEditable=s,this.Ordinal=c,this.isEditable=!1}}();exports.Fields=Fields;var SqlServerSchemaServices_1,SqlServerSchemaServices=SqlServerSchemaServices_1=function(){function e(){}return e.toJsonType=function(e){var r={};switch(e.Type){case SMALLINT:case INTEGER:case BIGINT:case INT:case INT2:case INT4:case INT8:case TINYINT:r=activity_jsonschema_1.JsonSchema.Types.integerType();break;case DOUBLE:case DECIMAL:case NUMERIC:case FLOAT:case FLOAT4:case FLOAT8:case REAL:r=activity_jsonschema_1.JsonSchema.Types.numberType();break;case BOOLEAN:r=activity_jsonschema_1.JsonSchema.Types.boolType();break;case VARCHAR:case CHAR:case BPCHAR:case NCHAR:case CHARACTER:r=activity_jsonschema_1.JsonSchema.Types.stringType();break;case DATE:case TIMESTAMPTZ:r=activity_jsonschema_1.JsonSchema.Types.dateType();break;case TIMESTAMP:r=activity_jsonschema_1.JsonSchema.Types.timeType();break;default:r=activity_jsonschema_1.JsonSchema.Types.stringType()}return r},e.prototype.fetchQueryMetadata=function(e,r,t,a,s){var c=this;return Rx_1.Observable.of(e).map(function(e){return Object.assign({queryString:e,queryURL:r,connection:c})}).mergeMap(function(e){return t(r,e)}).mergeMap(function(r){return SqlServerSchemaServices_1.createFields(e,r.Fields,a,s)})},e.sortFields=function(e,r){return e.Ordinal-r.Ordinal},e.createFields=function(e,r,t,a){var s=r;if(t&&a&&(s=s.concat(JSON.parse(a))),null!=s&&s.length>0){for(var c=[(s=s.filter(function(e){return null!=e}).sort(SqlServerSchemaServices_1.sortFields))[0]],i=1;i<s.length;i++){for(var n=!1,o=0;o<c.length;o++)if(i!==o&&s[i].FieldName===c[o].FieldName){n=!0;break}n||c.push(s[i])}s=c}return Rx_1.Observable.from(s).reduce(function(e,r){var a={FieldName:r.FieldName,Type:r.Type,Selected:r.Selected,Parameter:r.Parameter,isEditable:t,Ordinal:void 0===r.Ordinal?0:r.Ordinal};return r.Value&&(a.Value=r.Value),e.fields.push(a),e.fields.sort(SqlServerSchemaServices_1.sortFields),e},{ok:!0,query:e,fields:[]})},e.getSchemaServices=function(e){var r=new SqlServerSchemaServices_1;return Rx_1.Observable.from(e).reduce(function(e,r){return e[r.name]=r.value,e},r)},e.getConnection=function(e){var r=new SqlServerSchemaServices_1;return Rx_1.Observable.from(e).reduce(function(e,r){return e[r.name]=r.value,e},r)},e.prototype.getInputSchema=function(e){var r=activity_jsonschema_1.JsonSchema.Types.rootObject(),t=activity_jsonschema_1.JsonSchema.Types.inputObject();r.properties.parameters=t.parameters;var a=r.properties.parameters.properties;return Rx_1.Observable.from(e).filter(function(e){return!0===e.Parameter||"true"===e.Parameter}).reduce(function(e,r){return e[r.FieldName]=SqlServerSchemaServices_1.toJsonType(r),e},a).mergeMap(function(e){return Rx_1.Observable.of(r)})},e}();SqlServerSchemaServices=SqlServerSchemaServices_1=__decorate([core_1.Injectable()],SqlServerSchemaServices),exports.SqlServerSchemaServices=SqlServerSchemaServices;
//# sourceMappingURL=activity.schema.services.js.map
