"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var s,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),Observable_1=require("rxjs/Observable"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),MessageTypeList=[{unique_id:"plainText",name:"Plain Text"},{unique_id:"custom",name:"Custom or Platform Specific"}],IS_Publish_PlainText={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["Message"],properties:{Message:{type:"string"},MessageAttributes:{type:"object",properties:{}},PhoneNumber:{type:"string"},Subject:{type:"string"},TargetArn:{type:"string"},TopicArn:{type:"string"}}},IS_Publish_Custom={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["Message"],properties:{Message:{type:"object",required:["default"],properties:{default:{type:"string"},email:{type:"string"},sqs:{type:"string"},lambda:{type:"string"},http:{type:"string"},https:{type:"string"},sms:{type:"string"},APNS:{type:"object",properties:{}},APNS_SANDBOX:{type:"object",properties:{}},APNS_VOIP:{type:"object",properties:{}},APNS_VOIP_SANDBOX:{type:"object",properties:{}},MACOS:{type:"object",properties:{}},MACOS_SANDBOX:{type:"object",properties:{}},GCM:{type:"object",properties:{}},ADM:{type:"object",properties:{}},BAIDU:{type:"object",properties:{}},MPNS:{type:"string"},WNS:{type:"string"}}},MessageAttributes:{type:"object",properties:{}},PhoneNumber:{type:"string"},Subject:{type:"string"},TargetArn:{type:"string"},TopicArn:{type:"string"}}},OS_Publish={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{MessageId:{type:"string"}}},snspublishHandler=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.injector=t,i.http=r,i.value=function(e,t){var r=t.getField("connection").value,s=t.getField("messageType").value;switch(e){case"connection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(i.http,"AWS").subscribe(function(r){r.forEach(function(e){for(var r=0;r<e.settings.length;r++)if("name"===e.settings[r].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[r].value});break}}),e.next(t)})});case"messageType":if(r)return MessageTypeList;break;case"input":if(r){var n=t.getField("messageAttributeNames"),o=i.inputSchemaProvider(s);if(n.value){for(var a={},p=JSON.parse(n.value),c=[],u=0;u<p.length;u++)a[p[u].AttributeName]={type:"string"},c.push(p[u].AttributeName);return o.properties.MessageAttributes.required=c,o.properties.MessageAttributes.properties=a,JSON.stringify(o)}return o.properties.MessageAttributes={type:"object",properties:{}},JSON.stringify(o)}break;case"output":if(r)return JSON.stringify(i.outputSchemaProvider(s))}},i.validate=function(e,t){return Observable_1.Observable.create(function(e){var t=wi_contrib_1.ValidationResult.newValidationResult();e.next(t)})},i.action=function(e,t){return Observable_1.Observable.create(function(e){var t=wi_contrib_1.ActionResult.newActionResult();e.next(t)})},i}return __extends(t,e),t.prototype.inputSchemaProvider=function(e){switch(e){case"plainText":return IS_Publish_PlainText;case"custom":return IS_Publish_Custom}},t.prototype.outputSchemaProvider=function(e){switch(e){case"plainText":case"custom":return OS_Publish}},t}(wi_contrib_1.WiServiceHandlerContribution);snspublishHandler=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http])],snspublishHandler),exports.snspublishHandler=snspublishHandler;
//# sourceMappingURL=snspublishHandler.js.map
