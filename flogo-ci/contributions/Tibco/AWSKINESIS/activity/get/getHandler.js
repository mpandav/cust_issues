"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate=this&&this.__decorate||function(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),Observable_1=require("rxjs/Observable"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),lodash=require("lodash"),GetShardIteratorInputConfiguration={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{ShardId:{type:"string",required:"true"},ShardIteratorType:{type:"string",required:"true",enum:["AT_SEQUENCE_NUMBER","AFTER_SEQUENCE_NUMBER","TRIM_HORIZON","LATEST","AT_TIMESTAMP"]},StartingSequenceNumber:{type:"string",required:"false"},StreamName:{type:"string",required:"true"},Timestamp:{type:"string",required:"false"}},required:["ShardId","ShardIteratorType","StreamName"]},GetShardIteratorOutputConfiguration={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{ShardIterator:{type:"string"}}},GetRecordsInputConfiguration={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{Limit:{type:"integer",required:"false"},ShardIterator:{type:"string",required:"true"}},required:["ShardIterator"]},GetRecordsOutputConfiguration={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{MillisBehindLatest:{type:"integer"},NextShardIterator:{type:"string"},Records:{type:"array",items:{type:"object",properties:{ApproximateArrivalTimestamp:{type:"string"},Data:{type:"any"},EncryptionType:{type:"string"},PartitionKey:{type:"string"},SequenceNumber:{type:"string"}}}}}},KinesisErrorConfiguration={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{error_code:{type:"string",required:"false"},error_message:{type:"string",required:"false"},requestId:{type:"string",required:"false"},statusCode:{type:"string",required:"false"}}},getHandler=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.injector=t,n.http=r,n.value=function(e,t){var r=t.getField("awsConnection").value,a=t.getField("streamType").value,i=t.getField("getType").value;switch(e){case"awsConnection":return Observable_1.Observable.create(function(e){var t=[];wi_contrib_1.WiContributionUtils.getConnections(n.http,"AWS").subscribe(function(r){r.forEach(function(e){for(var r=0;r<e.settings.length;r++)if("name"===e.settings[r].name){t.push({unique_id:wi_contrib_1.WiContributionUtils.getUniqueId(e),name:e.settings[r].value});break}}),e.next(t)})});case"input":var o;if(a&&r&&i)return Observable_1.Observable.create(function(e){"DataStream"===a&&("Records"===i?o=lodash.cloneDeep(GetRecordsInputConfiguration):"ShardIterator"===i&&(o=lodash.cloneDeep(GetShardIteratorInputConfiguration))),null!==o?e.next(JSON.stringify(o)):e.next(o)});case"Message":var s;if(a&&r&&i)return Observable_1.Observable.create(function(e){"DataStream"===a&&("Records"===i?s=lodash.cloneDeep(GetRecordsOutputConfiguration):"ShardIterator"===i&&(s=lodash.cloneDeep(GetShardIteratorOutputConfiguration))),null!==s?e.next(JSON.stringify(s)):e.next(s)});case"Error":return Observable_1.Observable.create(function(e){var t=lodash.cloneDeep(KinesisErrorConfiguration);null!=t?e.next(JSON.stringify(t)):e.next(t)});default:return null}},n.validate=function(e,t){return Observable_1.Observable.create(function(e){var t=wi_contrib_1.ValidationResult.newValidationResult();e.next(t)})},n.action=function(e,t){return Observable_1.Observable.create(function(e){var t=wi_contrib_1.ActionResult.newActionResult();e.next(t)})},n}return __extends(t,e),t}(wi_contrib_1.WiServiceHandlerContribution);getHandler=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http])],getHandler),exports.getHandler=getHandler;
//# sourceMappingURL=getHandler.js.map
