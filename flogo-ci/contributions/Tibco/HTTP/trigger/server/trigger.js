"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,r,o){var i,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(n=(a<3?i(n):a>3?i(t,r,n):i(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var http_1=require("@angular/http"),core_1=require("@angular/core"),lodash=require("lodash"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),opaqueSchema={},HttpContribModule=function(e){function t(t,r,o){var i=e.call(this,t,r,o)||this;return i.injector=t,i.http=r,i.contribModelService=o,i.value=function(e,t){var r=i.getContextVar(t,"processingMode");switch(e){case"proxyData":return JSON.stringify(i.getOutputSchema(r))}return null},i.validate=function(e,t){var r=i.getContextVar(t,"processingMode").trim(),o=i.getContextVar(t,"reqMethod").trim();return"proxyData"===e.trim()?wi_contrib_1.ValidationResult.newValidationResult().setVisible("Proxy"===r):["reqMethod","pathParams","queryParams","headers","method","requestBody","statusCode","responseBody","cookies"].includes(e.trim())?"Data"===r?"requestBody"===e.trim()&&["GET","DELETE"].includes(o)?wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1):null},i.action=function(e,t){for(var r=i.getModelService(),o=wi_contrib_1.CreateFlowActionResult.newActionResult(),a=r.createTriggerElement("HTTP/tibco-flogo-http-trigger"),n=t.getField("port"),s=t.getField("processingMode").value,p=0;p<a.settings.length;p++)"port"===a.settings[p].name&&(a.settings[p].value=n.value),"processingMode"===a.settings[p].name&&(a.settings[p].value=s);for(var c=0;c<a.handler.settings.length;c++)a.handler.settings[c].value=t.getField(a.handler.settings[c].name).value;for(var d=i.contribModelService.createMapping(),l=0;l<a.outputs.length;l++)"proxyData"===a.outputs[l].name&&"Proxy"===s&&d.addMapping("$INPUT['proxyData']",i.contribModelService.createMapExpression().setExpression("$trigger.proxyData")),"pathParams"===a.outputs[l].name&&"Data"===s&&d.addMapping("$INPUT['pathParams']",i.contribModelService.createMapExpression().setExpression("$trigger.pathParams")),"queryParams"===a.outputs[l].name&&"Data"===s&&d.addMapping("$INPUT['queryParams']",i.contribModelService.createMapExpression().setExpression("$trigger.queryParams")),"headers"===a.outputs[l].name&&"Data"===s&&d.addMapping("$INPUT['headers']",i.contribModelService.createMapExpression().setExpression("$trigger.headers")),"method"===a.outputs[l].name&&"Data"===s&&d.addMapping("$INPUT['method']",i.contribModelService.createMapExpression().setExpression("$trigger.method")),"requestBody"===a.outputs[l].name&&"Data"===s&&d.addMapping("$INPUT['requestBody']",i.contribModelService.createMapExpression().setExpression("$trigger.requestBody"));var u=i.contribModelService.createMapping();u.addMapping("$INPUT['statusCode']",i.contribModelService.createMapExpression().setExpression("$flow.statusCode")),u.addMapping("$INPUT['headers']",i.contribModelService.createMapExpression().setExpression("$flow.headers")),u.addMapping("$INPUT['responseBody']",i.contribModelService.createMapExpression().setExpression("$flow.responseBody")),u.addMapping("$INPUT['cookies']",i.contribModelService.createMapExpression().setExpression('array.forEach($flow.cookies, "cookies")')),a.inputMappings=d,a.outputMappings=u;var g=r.createFlow(t.getFlowName(),t.getFlowDescription());return o=o.addTriggerFlowMapping(lodash.cloneDeep(a),lodash.cloneDeep(g)),wi_contrib_1.ActionResult.newActionResult().setSuccess(!0).setResult(o)},i.category="HTTP",i}return __extends(t,e),t.prototype.getOutputSchema=function(e){return"Proxy"===e?opaqueSchema:""},t.prototype.getContextVar=function(e,t){return e.getField(t)?void 0===e.getField(t).value?"":e.getField(t).value:""},t}(wi_contrib_1.WiServiceHandlerContribution);HttpContribModule=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http,wi_contrib_1.WiContribModelService])],HttpContribModule),exports.HttpContribModule=HttpContribModule;
//# sourceMappingURL=trigger.js.map
