"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(s=(r<3?n(s):r>3?n(t,a,s):n(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),Observable_1=require("rxjs/Observable"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),wi_contrib_2=require("wi-studio/app/contrib/wi-contrib"),connectinMap={},producerHandler=function(e){function t(t,a){var i=e.call(this,t,a)||this;return i.injector=t,i.http=a,i.value=function(e,t){if("kafkaConnection"===e)return Observable_1.Observable.create(function(e){var t=[];wi_contrib_2.WiContributionUtils.getConnections(i.http,"Kafka","tibco-kafka").subscribe(function(a){a.forEach(function(e){for(var a,i,n,r,s,o,l=0;l<e.settings.length;l++)if("name"===e.settings[l].name)a=wi_contrib_2.WiContributionUtils.getUniqueId(e),i=e.settings[l].value,t.push({unique_id:a,name:i});else if("useSchmaRegistry"===e.settings[l].name)n=e.settings[l].value;else if("url"===e.settings[l].name)o=e.settings[l].value;else if("userName_schemaRegistry"===e.settings[l].name)r=e.settings[l].value;else if("password_schemaRegistry"===e.settings[l].name){s=e.settings[l].value,connectinMap[a]={url:o,flagValue:n,username:r,password:s};break}}),console.log("Printing connection maps"),console.log(connectinMap),e.next(t)})});if("Avro"===t.getField("valueType").value){var a=t.getField("kafkaConnection").value;if(connectinMap[a].flagValue){var n=t.getField("kafkaConnection").value,r=connectinMap[n].url;if(0===(r=r.concat("/subjects")).toString().indexOf("https")){console.log("I am https");var s=connectinMap[n].username,o=connectinMap[n].password;if(null!==s&&0!==s.toString().trim().length&&null!==o&&0!==o.toString().trim().length){var l=connectinMap[n].username,c=connectinMap[n].password,u=l.concat(":",c),d="Basic ".concat(btoa(u));if("subjects"===e)return Observable_1.Observable.create(function(e){wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,r).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",d).send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})});if("versions"===e){var b=t.getField("subjects").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",b,"/versions");wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",d).send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})})}if("avroData"===e){var v=t.getField("subjects").value,p=t.getField("versions").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",v,"/versions/",p);wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",d).send().subscribe(function(t){200===t.status?e.next(t.json().schema):e.next(t)})})}}else{if("subjects"===e)return Observable_1.Observable.create(function(e){wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,r).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})});if("versions"===e){var _=t.getField("subjects").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",_,"/versions");wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})})}if("avroData"===e){var f=t.getField("subjects").value,g=t.getField("versions").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",f,"/versions/",g);wi_contrib_1.WiProxyCORSUtils.createSSLRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json().schema):e.next(t)})})}}}else{s=connectinMap[n].username,o=connectinMap[n].password;if(console.log("I am http"),null!==s&&0!==s.toString().trim().length&&null!==o&&0!==o.toString().trim().length){u=s.concat(":",o);var R="Basic ".concat(btoa(u));if("subjects"===e)return Observable_1.Observable.create(function(e){wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,r).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",R).send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})});if("versions"===e){var h=t.getField("subjects").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",h,"/versions");wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",R).send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})})}if("avroData"===e){var w=t.getField("subjects").value,V=t.getField("versions").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",w,"/versions/",V);wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").addHeader("Authorization",R).send().subscribe(function(t){200===t.status?e.next(t.json().schema):e.next(t)})})}}else{if("subjects"===e)return Observable_1.Observable.create(function(e){wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,r).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})});if("versions"===e){var O=t.getField("subjects").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",O,"/versions");wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json()):e.next(t)})})}if("avroData"===e){var m=t.getField("subjects").value,j=t.getField("versions").value;return Observable_1.Observable.create(function(e){var t=r.concat("/",m,"/versions/",j);wi_contrib_1.WiProxyCORSUtils.createRequest(i.http,t).addMethod("GET").addHeader("accept","application/json").send().subscribe(function(t){200===t.status?e.next(t.json().schema):e.next(t)})})}}}}}return null},i.validate=function(e,t){if("stringValue"===e)return"String"===t.getField("valueType").value?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1);if("jsonValue"===e)return"JSON"===t.getField("valueType").value?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1);if("avroData"===e){if("Avro"===t.getField("valueType").value){var a=t.getField("kafkaConnection").value;return connectinMap[a].flagValue?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0).setReadOnly(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0).setReadOnly(!1)}return wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}if("subjects"===e){if("Avro"===t.getField("valueType").value){console.log("I am Avro");a=t.getField("kafkaConnection").value;return connectinMap[a].flagValue?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}return wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}if("versions"===e){if("Avro"===t.getField("valueType").value){a=t.getField("kafkaConnection").value;return connectinMap[a].flagValue?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}return wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}if("ackTimeout"===e)return"All"===t.getField("ackMode").value?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1);if("partition"===e){var n=t.getField("partitioner");return n&&"Manual"===n.value?wi_contrib_2.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_2.ValidationResult.newValidationResult().setVisible(!1)}return"headers"===e?i.validateParametersByName(e,t):null},i}return __extends(t,e),t.prototype.validateParametersByName=function(e,t){return Observable_1.Observable.create(function(a){var i=wi_contrib_2.ValidationResult.newValidationResult(),n=t.getField(e),r=[],s="",o={};try{o=JSON.parse(n.value)}catch(e){}for(var l=0,c=o;l<c.length;l++){var u=c[l];if(!u.parameterName){s="Parameter Name should not be empty",i.setError("Kafka-1001",s),i.setValid(!1);break}for(var d=0,b=r;d<b.length;d++){if(b[d]===u.parameterName){s="Parameter Name '"+u.parameterName+"' already exists",i.setError("Kafka-1001",s),i.setValid(!1);break}}r.push(u.parameterName)}a.next(i),a.complete()})},t}(wi_contrib_2.WiServiceHandlerContribution);producerHandler=__decorate([wi_contrib_2.WiContrib({}),core_1.Injectable(),__metadata("design:paramtypes",[core_1.Injector,http_1.Http])],producerHandler),exports.producerHandler=producerHandler;
//# sourceMappingURL=producerHandler.js.map
