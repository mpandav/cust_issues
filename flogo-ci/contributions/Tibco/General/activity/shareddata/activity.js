"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var a,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(n=(o<3?a(n):o>3?a(e,i,n):a(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(t,e){return function(i,r){e(i,r,t)}};Object.defineProperty(exports,"__esModule",{value:!0});var Observable_1=require("rxjs/Observable"),http_1=require("@angular/http"),core_1=require("@angular/core"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),STRING_SCHEMA={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{data:{type:"string"}}},STRING_SCHEMA_OUT={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{exist:{type:"boolean"},data:{type:"string"}}},NUMBER_SCHEMA={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{data:{type:"number"}}},NUMBER_SCHEMA_OUT={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{exist:{type:"boolean"},data:{type:"number"}}},INTEGER_SCHEMA={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{data:{type:"integer"}}},INTEGER_SCHEMA_OUT={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{exist:{type:"boolean"},data:{type:"integer"}}},DELETE_OUT_SCHEMA={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{exist:{type:"boolean"}}},AppDataActivityContribution=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.http=i,r.value=function(t,e){var i=e.getField("operation"),a=e.getField("type"),o=e.getField("scope");if("METADATA:ICON"===t)return Observable_1.Observable.create(function(t){"Application"===o.value?(t.next("icons/ic-datastore-application.png"),t.complete()):(t.next("icons/ic-datastore-flow.png"),t.complete())});if("operation"===t)return"Application"===o.value?["GET","SET","DELETE"]:["GET","SET"];if("input"===t){if("SET"===i.value){if("string"===a.value)return JSON.stringify(STRING_SCHEMA);if("integer"===a.value)return JSON.stringify(INTEGER_SCHEMA);if("number"===a.value)return JSON.stringify(NUMBER_SCHEMA);if("object"===a.value){var n=e.getField("objectSchema");return r.isJson(n.value)?'{"data":'+n.value+"}":JSON.stringify(r.constructInputSchema(n.value))}}}else if("output"===t)if("GET"===i.value){if("string"===a.value)return JSON.stringify(STRING_SCHEMA_OUT);if("integer"===a.value)return JSON.stringify(INTEGER_SCHEMA_OUT);if("number"===a.value)return JSON.stringify(NUMBER_SCHEMA_OUT);if("object"===a.value){n=e.getField("objectSchema");return r.isJson(n.value)?'{ "exist":false, "data":'+n.value+"}":JSON.stringify(r.constructOutputSchema(n.value))}}else if("DELETE"===i.value)return JSON.stringify(DELETE_OUT_SCHEMA);return null},r.validate=function(t,e){var i=e.getField("type"),r=e.getField("operation");if("type"===t)return"DELETE"===r.value?wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!0);if("objectSchema"===t)return"object"===i.value&&"DELETE"!==r.value?wi_contrib_1.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1);if("input"===t){var a=e.getField("operation");return"GET"===a.value||"DELETE"===a.value?wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!0)}if("output"===t){var o=e.getField("operation");return"GET"===o.value||"DELETE"===o.value?wi_contrib_1.ValidationResult.newValidationResult().setVisible(!0):wi_contrib_1.ValidationResult.newValidationResult().setVisible(!1)}return null},r}return __extends(e,t),e.prototype.isJson=function(t){try{t=JSON.parse(t)}catch(e){t={}}var e=!0;return t&&t.type&&"string"==typeof t.type&&(t.properties||t.items)&&(e=!1),t&&t.allOf&&t.allOf.length&&(e=!1),t&&t.oneOf&&t.oneOf.length&&(e=!1),t&&t.anyOf&&t.anyOf.length&&(e=!1),e},e.prototype.constructOutputSchema=function(t){var e={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{exist:{type:"boolean"},data:{type:"object",properties:{}}}};try{t=JSON.parse(t)}catch(e){t={}}if(delete t.tile,delete t.$id,delete t.$schema,t.title){var i={};i[t.title]=t,e.properties.data.properties=i}else"object"===t.type?e.properties.data.properties=t.properties:e.properties.data=t;return e},e.prototype.constructInputSchema=function(t){var e={$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{data:{type:"object",properties:{}}}};try{t=JSON.parse(t)}catch(e){t={}}if(delete t.tile,delete t.$id,delete t.$schema,t.title){var i={};i[t.title]=t,e.properties.data.properties=i}else"object"===t.type?e.properties.data.properties=t.properties:e.properties.data=t;return e},e}(wi_contrib_1.WiServiceHandlerContribution);AppDataActivityContribution=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],AppDataActivityContribution),exports.AppDataActivityContribution=AppDataActivityContribution;
//# sourceMappingURL=activity.js.map
