"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var swagger_validation_error_1=require("./swagger-validation-error"),BaseNode=function(){function e(e){this.name=e,this.errors=new swagger_validation_error_1.SwaggerValidationError}return e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e}();exports.BaseNode=BaseNode;var SwaggerNode=function(e){function t(t){var r=e.call(this,"Swagger")||this;return r.jsondata=t,r}return __extends(t,e),t.prototype.accept=function(e){if(e.visitEnterSwagger(this),this.jsondata.info){var t={type:"info",info:this.jsondata.info};(r=SwaggerNodeFactory.createNode(t).accept(e)).name="info",this.errors.addChildError(r)}if(this.jsondata.paths){var r;t={type:"paths",paths:this.jsondata.paths};(r=SwaggerNodeFactory.createNode(t).accept(e)).name="paths",this.errors.addChildError(r)}return e.visitLeaveSwagger(this),this.errors},t}(BaseNode);exports.SwaggerNode=SwaggerNode;var SwaggerInfoNode=function(e){function t(t){var r=e.call(this,"Info")||this;return r.info=t,r}return __extends(t,e),t.prototype.getTitle=function(){return this.info.title},t.prototype.accept=function(e){return e.visitEnterSwaggerInfo(this),e.visitLeaveSwaggerInfo(this),this.errors},t}(BaseNode);exports.SwaggerInfoNode=SwaggerInfoNode;var SwaggerPathsNode=function(e){function t(t){var r=e.call(this,"Paths")||this;return r.paths=t,r}return __extends(t,e),t.prototype.getPaths=function(){return this.paths},t.prototype.accept=function(e){e.visitEnterSwaggerPaths(this);var t=[],r={};for(var o in this.paths){var a=[];for(var n in t.push(o),this.paths[o])a.push(n);r[o]=a;var i={type:"methods",methods:this.paths[o],path:o},s=SwaggerNodeFactory.createNode(i).accept(e);s.name=o,this.errors.addChildError(s)}t.length<1&&((h=new swagger_validation_error_1.SwaggerValidationError).name="FATAL_ERROR",h.addError("No [paths] defined in the Swagger specification. At least a single path is required"),this.errors.addChildError(h));for(var p=0,d=t;p<d.length;p++){var h;o=d[p];if(!this.verifyPathStartSlash(o))(h=new swagger_validation_error_1.SwaggerValidationError).name="FATAL_ERROR",h.addError("Resource path  ["+o+"] not supported due to invalid format"),this.errors.addChildError(h)}return this.findSimilarPath(t,r,t.length),e.visitLeaveSwaggerPaths(this),this.errors},t.prototype.intersectTwoMethodArrays=function(e,t){for(var r=[],o=0;o<e.length;o++)for(var a=0;a<t.length;a++)e[o]===t[a]&&r.push(e[o]);return r},t.prototype.findSimilarPath=function(e,t,r){for(var o=0;o<r;o++)for(var a=o+1;a<r;a++)if(!this.pathValidation(e[o],e[a])){var n=this.intersectTwoMethodArrays(t[e[o]],t[e[a]]),i=new swagger_validation_error_1.SwaggerValidationError;i.name="FATAL_ERROR";for(var s=0;s<n.length;s++)e[o].includes("{")&&e[a].includes("{")?i.addError("Parameterized route [ "+e[o]+" ] and parameterized route [ "+e[a]+" ]  for the same path segment with method [ "+n[s].toUpperCase()+" ] is not supported. Path [ "+e[a]+" ] will not be implemented."):e[o].includes("{")&&!e[a].includes("{")?i.addError("Static route [ "+e[a]+" ] and parameterized route [ "+e[o]+" ]  for the same path segment with method [ "+n[s].toUpperCase()+" ] is not supported. Path [ "+e[a]+" ] will not be implemented."):!e[o].includes("{")&&e[a].includes("{")&&i.addError("Static route [ "+e[o]+" ] and parameterized route [ "+e[a]+" ]  for the same path segment with method [ "+n[s].toUpperCase()+" ] is not supported. Path [ "+e[o]+" ] will not be implemented.");0===n.length&&(e[o].includes("{")&&!e[a].includes("{")?i.addError("Static route [ "+e[a]+" ] with method [ "+t[e[a]].map(function(e){return e.toUpperCase()})+" ] and parameterized route [ "+e[o]+" ] with method [ "+t[e[o]].map(function(e){return e.toUpperCase()})+" ] is not supported. Path [ "+e[a]+" ] will not be implemented."):!e[o].includes("{")&&e[a].includes("{")&&i.addError("Static route [ "+e[o]+" ] with method [ "+t[e[o]].map(function(e){return e.toUpperCase()})+" ] and parameterized route [ "+e[a]+" ] with method [ "+t[e[a]].map(function(e){return e.toUpperCase()})+" ] is not supported. Path [ "+e[o]+" ] will not be implemented.")),this.errors.addChildError(i)}},t.prototype.verifyPathStartSlash=function(e){return/(?:(?:^\/){1}(?:[-a-zA-Z0-9_]+)){1}(?:(?:(?:[\/]{1})(?:(?:(?:[\{]{1})(?:[-a-zA-Z0-9_\:]+)(?:[\}]{1}))|(?:[-a-zA-Z0-9_\:]+)))*)$/i.test(e)},t.prototype.pathValidation=function(e,t){if(e&&t){var r=e.trim().split("/"),o=t.trim().split("/");if(""===r[r.length-1]&&r.splice(r.length-1,1),""===o[o.length-1]&&o.splice(o.length-1,1),r.length!==o.length)return!0;var a=void 0;for(a=0;a<r.length&&(r[a]!==r[a].replace(/.*\{|\}/gi,"")||o[a]!==o[a].replace(/.*\{|\}/gi,"")||!r[a]||!o[a]||r[a]===o[a]);a++);return a!==r.length}return!1},t}(BaseNode);exports.SwaggerPathsNode=SwaggerPathsNode;var SwaggerMethodsNode=function(e){function t(t,r){var o=e.call(this,"Methods")||this;return o.methods=t,o.path=r,o}return __extends(t,e),t.prototype.getMethods=function(){var e=[];for(var t in this.methods)"parameters"!==t&&e.push(t);return e},t.prototype.accept=function(e){for(var t in e.visitEnterSwaggerMethods(this),this.methods){var r={type:"method",methodData:this.methods[t],method:t},o=SwaggerNodeFactory.createNode(r).accept(e);o.name=t,this.errors.addChildError(o)}return e.visitLeaveSwaggerMethods(this),this.errors},t}(BaseNode);exports.SwaggerMethodsNode=SwaggerMethodsNode;var SwaggerMethodNode=function(e){function t(t,r){var o=e.call(this,"Method")||this;return o.methodData=t,o.method=r,o}return __extends(t,e),t.prototype.getParameters=function(){return"string"!=typeof this.methodData&&this.methodData.parameters?this.methodData.parameters:[]},t.prototype.getResponses=function(){return"string"!=typeof this.methodData&&this.methodData.responses?this.methodData.responses:{}},t.prototype.getFlowName=function(){return"string"!=typeof this.methodData&&this.methodData.summary?this.methodData.summary:""},t.prototype.accept=function(e){return e.visitEnterSwaggerMethod(this),e.visitLeaveSwaggerMethod(this),this.errors},t}(BaseNode);exports.SwaggerMethodNode=SwaggerMethodNode;var AbstractSwaggerNodeVisitor=function(){return function(){}}();exports.AbstractSwaggerNodeVisitor=AbstractSwaggerNodeVisitor;var SwaggerNodeFactory=function(){function e(){}return e.createNode=function(e){return"2.0"===e.swagger?new SwaggerNode(e):"info"===e.type?new SwaggerInfoNode(e.info):"paths"===e.type?new SwaggerPathsNode(e.paths):"methods"===e.type?new SwaggerMethodsNode(e.methods,e.path):"method"===e.type?new SwaggerMethodNode(e.methodData,e.mathod):void 0},e}();exports.SwaggerNodeFactory=SwaggerNodeFactory;var SwaggerVisitor=function(e){function t(t){var r=e.call(this)||this;return r.swaggerSpec=t,r}return __extends(t,e),t.prototype.visitEnterSwagger=function(e){},t.prototype.visitLeaveSwagger=function(e){},t.prototype.visitEnterSwaggerInfo=function(e){},t.prototype.visitLeaveSwaggerInfo=function(e){},t.prototype.visitEnterSwaggerPaths=function(e){},t.prototype.visitLeaveSwaggerPaths=function(e){},t.prototype.visitEnterSwaggerMethods=function(e){for(var t=["PUT","POST","GET","DELETE"],r=0,o=e.getMethods();r<o.length;r++){var a=o[r];if(-1===t.indexOf(a.toUpperCase())){var n=new swagger_validation_error_1.SwaggerValidationError;n.name=a,n.addError("Unsupported Method ["+a.toUpperCase()+"] for the path [PATH_NAME]. Method will not be implemented. Supported methods are PUT, POST, GET and DELETE."),e.errors.addChildError(n)}}},t.prototype.visitLeaveSwaggerMethods=function(e){},t.prototype.visitEnterSwaggerMethod=function(e){for(var t=[],r=[],o=[],a=0,n=e.getParameters();a<n.length;a++){var i=n[a];for(var s in i)i.hasOwnProperty(s)&&"in"===s&&("formData"===i[s]?e.errors.addError("Unsupported Parameter [formData] with name ["+i.name+"] defined for method [METHOD_NAME] for the path [PATH_NAME]. Parameter configuration will be omitted."):"path"===i[s]?"string"!==i.type&&"number"!==i.type&&"boolean"!==i.type&&"integer"!==i.type&&"long"!==i.type&&r.indexOf(i.type)<0&&r.push(i.type):"query"===i[s]?"array"===i.type?"string"!==i.items.type&&"number"!==i.items.type&&"boolean"!==i.items.type&&"integer"!==i.items.type&&"long"!==i.items.type&&o.indexOf(i.items.type)<0&&o.push(i.items.type+":"+i.name):"string"!==i.type&&"number"!==i.type&&"boolean"!==i.type&&"integer"!==i.type&&"long"!==i.type&&o.indexOf(i.type)<0&&o.push(i.type+":"+i.name):"header"===i[s]&&("array"===i.type?"string"!==i.items.type&&"number"!==i.items.type&&"boolean"!==i.items.type&&"integer"!==i.items.type&&"long"!==i.items.type&&t.indexOf(i.items.type)<0&&t.push(i.items.type+":"+i.name):"string"!==i.type&&"number"!==i.type&&"boolean"!==i.type&&"integer"!==i.type&&"long"!==i.type&&t.indexOf(i.type)<0&&t.push(i.type+":"+i.name)))}if(t.length>0)for(var p=0;p<t.length;p++){var d=t[p].split(":"),h="";"array"===d[0]&&(h+="nested "+d[0]),e.errors.addError("Unsupported data type ["+h+"] in header parameter ["+d[1]+"] defined for method [METHOD_NAME] for the path [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type.")}if(r.length>0&&e.errors.addError("Unsupported data type ["+r+"] in path parameter [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type."),o.length>0)for(p=0;p<o.length;p++){var g=o[p].split(":"),u="";"array"===g[0]&&(u+="nested "+g[0]),e.errors.addError("Unsupported data type ["+u+"] in query parameter ["+g[1]+"] defined for method [METHOD_NAME] for the path [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type.")}},t.prototype.visitLeaveSwaggerMethod=function(e){},t}(AbstractSwaggerNodeVisitor);exports.SwaggerVisitor=SwaggerVisitor;
//# sourceMappingURL=swagger-vistor.js.map
