"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var types_1=require("wi-studio/common/types");exports.PARAMETER_IN=types_1.strEnum(["query","header","path","formData","body","cookie"]);var Swagger=function(){function s(s){this.update(s)}return s.prototype.update=function(s){return this.openapi=s.openapi||this.openapi,this.swagger=s.swagger||this.swagger,this.info=s.info||this.info,this.servers=s.servers||this.servers||[],this.host=s.host||this.host||"",this.basePath=s.basePath||this.basePath||"",this.schemes=s.schemes||this.schemes||[],this.consumes=s.consumes||this.consumes||[],this.produces=s.produces||this.produces||[],this.paths=s.paths||this.paths||{},this.definitions=s.definitions||this.definitions||{},this.parameters=s.parameters||this.parameters||{},this.responses=s.responses||this.responses||{},this.securityDefinitions=s.securityDefinitions||this.securityDefinitions||{},this.security=s.security||this.security||[],this.tags=s.tags||this.tags||[],this.externalDocs=s.externalDocs||this.externalDocs||{},this.components=s.components||this.components||{},this},s.prototype.isOAS3=function(){var s=this.openapi;return!(!s||void 0===s||"3"!==(s=s.trim())[0])},s.prototype.getConsumes=function(){return this.consumes},s.prototype.getAppName=function(){return this.info.title},s.prototype.getPaths=function(){var s=[];for(var t in this.paths)s.push(t);return s},s.prototype.getMethods=function(s){var t=[];if(this.paths[s])for(var e in this.paths[s])"parameters"!==e&&t.push(e);return t},s.prototype.getServerURLs=function(s,t){var e=[];if(this.servers)for(var r=0;r<this.servers.length;r++)if(this.servers[r].variables&&void 0!==this.servers[r].variables){for(var i=[],h=Object.keys(this.servers[r].variables),a=!1,n=0;n<h.length;n++)if(a=0===n,this.servers[r].variables[h[n]].enum&&void 0!==this.servers[r].variables[h[n]].enum){for(var o=[],p=0;p<this.servers[r].variables[h[n]].enum.length;p++)if(a){var u="{"+h[n]+"}";i.push(this.servers[r].url.replace(u,this.servers[r].variables[h[n]].enum[p]))}else for(var c=0;c<i.length;c++){u="{"+h[n]+"}";o.push(i[c].replace(u,this.servers[r].variables[h[n]].enum[p]))}a||(i=o)}else if(this.servers[r].variables[h[n]].default&&void 0!==this.servers[r].variables[h[n]].default)if(a){u="{"+h[n]+"}";var f=this.servers[r].url;i.push(f.replace(u,this.servers[r].variables[h[n]].default))}else for(c=0;c<i.length;c++){u="{"+h[n]+"}";i[c]=i[c].replace(u,this.servers[r].variables[h[n]].default)}e=e.concat(i)}else e.push(this.servers[r].url);return e},s.prototype.getRequestTypes=function(s,t){var e=[];if(this.isOAS3)try{if(this.paths[s][t].requestBody&&this.paths[s][t].requestBody.content)e=Object.keys(this.paths[s][t].requestBody.content)}catch(s){return e}return e},s.prototype.getParameters=function(s,t){var e=[];if(this.paths[s]&&this.paths[s][t]&&"string"!=typeof this.paths[s][t]){if(this.isOAS3()){try{if(void 0!==(o=this.paths[s].parameters))for(var r={},i=0;i<o.length;i++)r.in=o[i].in,r.name=o[i].name,r.type=o[i].schema.type,r.required=o[i].required,"array"===r.type&&(r.items=o[i].schema.items),e.push(r);if(this.paths[s][t].parameters&&void 0!==this.paths[s][t].parameters){var h=this.paths[s][t].parameters,a=!1;for(i=0;i<h.length;i++){r={};"cookie"===h[i].in?a||(a=!0,r.in="header",r.name="cookie",r.type="string",h[i].required?r.required=h[i].required:r.required=!1,e.push(r)):(r.in=h[i].in,r.name=h[i].name,r.type=h[i].schema.type,r.required=h[i].required,"array"===r.type&&(r.items=h[i].schema.items),e.push(r))}}if(this.paths[s][t].requestBody&&void 0!==this.paths[s][t].requestBody){r={};this.paths[s][t].requestBody.content&&void 0!==this.paths[s][t].requestBody.content&&(this.paths[s][t].requestBody.content["application/json"]&&void 0!==this.paths[s][t].requestBody.content["application/json"]?(r.in="body",r.schema=this.paths[s][t].requestBody.content["application/json"].schema,e.push(r)):this.paths[s][t].requestBody.content["application/x-www-form-urlencoded"]&&void 0!==this.paths[s][t].requestBody.content["application/x-www-form-urlencoded"]?(r.in="formData",r.schema=this.paths[s][t].requestBody.content["application/x-www-form-urlencoded"].schema,e.push(r)):this.paths[s][t].requestBody.content["multipart/form-data"]&&void 0!==this.paths[s][t].requestBody.content["multipart/form-data"]&&(r.in="multpartFormData",r.schema=this.paths[s][t].requestBody.content["multipart/form-data"].schema,e.push(r)))}}catch(s){return e}return e}try{var n=this.paths[s][t].parameters,o=[];void 0!==(o=this.paths[s].parameters)&&(e=e.concat(o)),void 0!==n&&(e=e.concat(n))}catch(s){return e}return e}},s.prototype.getResponse=function(s,t,e){var r={};if(!e||!e.toString()){if(this.isOAS3()){if(this.paths[s]&&this.paths[s][t]){var i=Object.keys(this.paths[s][t].responses);for(o=0;o<i.length;o++)if(this.paths[s][t].responses[i[o]].content&&this.paths[s][t].responses[i[o]].content["application/json"]?r[i[o]]=this.paths[s][t].responses[i[o]].content["application/json"]:r[i[o]]={description:""},this.paths[s][t].responses[i[o]].headers&&void 0!==this.paths[s][t].responses[i[o]].headers){a=Object.keys(this.paths[s][t].responses[i[o]].headers),n={};for(var h=0;h<a.length;h++)n[a[h]]="";r[i[o]].headers=n}}return r}return this.paths[s]&&this.paths[s][t]?this.paths[s][t].responses:r}if(this.paths[s]&&this.paths[s][t]&&"string"!=typeof this.paths[s][t]){if(this.isOAS3()){try{if(this.paths[s][t].responses&&this.paths[s][t].responses[e]&&void 0!==this.paths[s][t].responses[e]&&(r=this.paths[s][t].responses[e].content&&this.paths[s][t].responses[e].content["application/json"]?this.paths[s][t].responses[e].content["application/json"]:{description:""},this.paths[s][t].responses[e].headers&&void 0!==this.paths[s][t].responses[e].headers)){for(var a=Object.keys(this.paths[s][t].responses[e].headers),n={},o=0;o<a.length;o++)n[a[o]]="";r.headers=n}}catch(s){return r}return r}try{this.paths[s][t].responses[200]?r=this.paths[s][t].responses[e]:this.paths[s][t].responses[500]&&(r=this.paths[s][t].responses[500])}catch(s){return r}return r}},s.prototype.getDefaultResponseCode=function(s,t){if(!this.isOAS3()&&this.paths[s]&&this.paths[s][t]&&"string"!=typeof this.paths[s][t]){try{if(this.paths[s][t].responses[200])return"200";if(this.paths[s][t].responses[500])return"500"}catch(s){return"200"}return"200"}},s.prototype.resolveRefs=function(s){var t={};if(!this.isOAS3()){var e=s.split("/");if("#"===e[0]&&"definitions"===e[1]){for(var r=2;r<e.length;r++){if(!this.definitions[e[r]])return"Invalid $ref";t=this.definitions[e[r]]}return t}return"Invalid $ref"}},s.prototype.getFlowName=function(s,t){var e="";return this.paths[s]&&this.paths[s][t]&&"string"!=typeof this.paths[s][t]&&(e=this.paths[s][t].operationId||this.paths[s][t].summary||""),e},s}();exports.Swagger=Swagger;
//# sourceMappingURL=swagger.js.map
