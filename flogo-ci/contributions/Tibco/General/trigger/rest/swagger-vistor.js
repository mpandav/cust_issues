"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var swagger_validation_error_1=require("./swagger-validation-error"),BaseNode=function(){function t(t){this.name=t,this.errors=new swagger_validation_error_1.SwaggerValidationError}return t.prototype.getName=function(){return this.name},t.prototype.setName=function(t){this.name=t},t}();exports.BaseNode=BaseNode;var SwaggerNode=function(t){function e(e){var r=t.call(this,"Swagger")||this;return r.jsondata=e,r}return __extends(e,t),e.prototype.accept=function(t){t.visitEnterSwagger(this);var e="v2";if(this.jsondata.openapi&&(e="v3"),this.jsondata.info){var r={type:"info",info:this.jsondata.info,version:e};(o=SwaggerNodeFactory.createNode(r).accept(t)).name="info",this.errors.addChildError(o)}if(this.jsondata.paths){var o;r={type:"paths",paths:this.jsondata.paths,version:e};(o=SwaggerNodeFactory.createNode(r).accept(t)).name="paths",this.errors.addChildError(o)}return t.visitLeaveSwagger(this),this.errors},e}(BaseNode);exports.SwaggerNode=SwaggerNode;var SwaggerInfoNode=function(t){function e(e){var r=t.call(this,"Info")||this;return r.info=e,r}return __extends(e,t),e.prototype.getTitle=function(){return this.info.title},e.prototype.accept=function(t){return t.visitEnterSwaggerInfo(this),t.visitLeaveSwaggerInfo(this),this.errors},e}(BaseNode);exports.SwaggerInfoNode=SwaggerInfoNode;var SwaggerPathsNode=function(t){function e(e,r){var o=t.call(this,"Paths")||this;return o.paths=e,o.version=r,o}return __extends(e,t),e.prototype.getPaths=function(){return this.paths},e.prototype.accept=function(t){t.visitEnterSwaggerPaths(this);var e=[],r={};for(var o in this.paths){var a=[];for(var i in e.push(o),this.paths[o])a.push(i);r[o]=a;var n={type:"methods",methods:this.paths[o],path:o,version:this.version},s=SwaggerNodeFactory.createNode(n).accept(t);s.name=o,this.errors.addChildError(s)}e.length<1&&((h=new swagger_validation_error_1.SwaggerValidationError).name="FATAL_ERROR",h.addError("No [paths] defined in the Swagger specification. At least a single path is required"),this.errors.addChildError(h));for(var d=0,p=e;d<p.length;d++){var h;o=p[d];if(!this.verifyPathStartSlash(o))(h=new swagger_validation_error_1.SwaggerValidationError).name="FATAL_ERROR",h.addError("Resource path  ["+o+"] not supported due to invalid format"),this.errors.addChildError(h)}return this.findSimilarPath(e,r,e.length),t.visitLeaveSwaggerPaths(this),this.errors},e.prototype.intersectTwoMethodArrays=function(t,e){for(var r=[],o=0;o<t.length;o++)for(var a=0;a<e.length;a++)t[o]===e[a]&&r.push(t[o]);return r},e.prototype.findSimilarPath=function(t,e,r){for(var o=0;o<r;o++)for(var a=o+1;a<r;a++)if(!this.pathValidation(t[o],t[a])){var i=this.intersectTwoMethodArrays(e[t[o]],e[t[a]]),n=new swagger_validation_error_1.SwaggerValidationError;n.name="FATAL_ERROR";for(var s=0;s<i.length;s++)t[o].includes("{")&&t[a].includes("{")&&n.addError("Parameterized route [ "+t[o]+" ] and parameterized route [ "+t[a]+" ]  for the same path segment with method [ "+i[s].toUpperCase()+" ] is not supported. Path [ "+t[a]+" ] will not be implemented.");this.errors.addChildError(n)}},e.prototype.verifyPathStartSlash=function(t){if("/"===t)return!0;return/(?:(?:^\/){1}(?:(?:(?:[\{]{1})(?:[-a-zA-Z0-9_\:]+)(?:[\}]{1}))|(?:[-a-zA-Z0-9_]+))){1}(?:(?:(?:[\/]{1})(?:(?:(?:[\{]{1})(?:[-a-zA-Z0-9_\:]+)(?:[\}]{1}))|(?:[-a-zA-Z0-9_\:]+)))*)$/i.test(t)},e.prototype.pathValidation=function(t,e){if(t&&e){var r=t.trim().split("/"),o=e.trim().split("/");if(""===r[r.length-1]&&r.splice(r.length-1,1),""===o[o.length-1]&&o.splice(o.length-1,1),r.length!==o.length)return!0;var a=void 0;for(a=0;a<r.length&&(r[a]!==r[a].replace(/.*\{|\}/gi,"")||o[a]!==o[a].replace(/.*\{|\}/gi,"")||!r[a]||!o[a]||r[a]===o[a]);a++);return a!==r.length}return!1},e}(BaseNode);exports.SwaggerPathsNode=SwaggerPathsNode;var SwaggerMethodsNode=function(t){function e(e,r,o){var a=t.call(this,"Methods")||this;return a.methods=e,a.path=r,a.version=o,a}return __extends(e,t),e.prototype.getMethods=function(){var t=[];for(var e in this.methods)"parameters"!==e&&t.push(e);return t},e.prototype.accept=function(t){for(var e in t.visitEnterSwaggerMethods(this),this.methods){var r={type:"method",methodData:this.methods[e],method:e,version:this.version},o=SwaggerNodeFactory.createNode(r).accept(t);o.name=e,this.errors.addChildError(o)}return t.visitLeaveSwaggerMethods(this),this.errors},e}(BaseNode);exports.SwaggerMethodsNode=SwaggerMethodsNode;var SwaggerMethodNode=function(t){function e(e,r,o){var a=t.call(this,"Method")||this;return a.methodData=e,a.method=r,a.version=o,a}return __extends(e,t),e.prototype.getParameters=function(){if("v3"===this.version){var t=[];if("string"!=typeof this.methodData)try{if(this.methodData.parameters&&void 0!==this.methodData.parameters)for(var e=this.methodData.parameters,r=0;r<e.length;r++){var o={};"cookie"===e[r].in?(o.in="header",o.name=e[r].name,o.type=e[r].schema.type,o.required=e[r].required,"array"===o.type&&(o.items=e[r].schema.items),o.v3HeaderType="cookie",t.push(o)):(o.in=e[r].in,o.name=e[r].name,o.type=e[r].schema.type,o.required=e[r].required,"array"===o.type&&(o.items=e[r].schema.items),t.push(o))}if(this.methodData.requestBody&&void 0!==this.methodData.requestBody){o={};if(this.methodData.requestBody.content&&void 0!==this.methodData.requestBody.content)if(this.methodData.requestBody.content["application/json"]&&void 0!==this.methodData.requestBody.content["application/json"])o.in="body",o.schema=this.methodData.requestBody.content["application/json"].schema,t.push(o);else{var a=void 0,i=!1;if(this.methodData.requestBody.content["application/x-www-form-urlencoded"]&&void 0!==this.methodData.requestBody.content["application/x-www-form-urlencoded"]?a=this.methodData.requestBody.content["application/x-www-form-urlencoded"].schema.properties:this.methodData.requestBody.content["multipart/form-data"]&&void 0!==this.methodData.requestBody.content["multipart/form-data"]&&(a=this.methodData.requestBody.content["multipart/form-data"].schema.properties,i=!0),a)for(var n=Object.keys(a),s=0;s<n.length;s++){var d={in:"formData"};d.name=n[s],d.type=a[n[s]].type,a[n[s]].required?d.required=a[n[s]].required:d.required=!1,d.v3RequestType=i?"multipart":"urlencode",t.push(d)}}}return t}catch(e){return t}return t}return"string"!=typeof this.methodData&&this.methodData.parameters?this.methodData.parameters:[]},e.prototype.getResponses=function(){if("v3"===this.version){var t={};if(this.methodData&&"string"!=typeof this.methodData)for(var e=Object.keys(this.methodData.responses),r=0;r<e.length;r++)this.methodData.responses[e[r]].content&&this.methodData.responses[e[r]].content["application/json"]?t[e[r]]=this.methodData.responses[e[r]].content["application/json"]:t[e[r]]={description:""};return t}return"string"!=typeof this.methodData&&this.methodData.responses?this.methodData.responses:{}},e.prototype.getFlowName=function(){return"string"!=typeof this.methodData&&this.methodData.summary?this.methodData.summary:""},e.prototype.accept=function(t){return t.visitEnterSwaggerMethod(this,this.version),t.visitLeaveSwaggerMethod(this),this.errors},e}(BaseNode);exports.SwaggerMethodNode=SwaggerMethodNode;var AbstractSwaggerNodeVisitor=function(){return function(){}}();exports.AbstractSwaggerNodeVisitor=AbstractSwaggerNodeVisitor;var SwaggerNodeFactory=function(){function t(){}return t.createNode=function(t){return"2.0"===t.swagger?new SwaggerNode(t):"info"===t.type?new SwaggerInfoNode(t.info):"paths"===t.type?new SwaggerPathsNode(t.paths,t.version):"methods"===t.type?new SwaggerMethodsNode(t.methods,t.path,t.version):"method"===t.type?new SwaggerMethodNode(t.methodData,t.mathod,t.version):void 0},t}();exports.SwaggerNodeFactory=SwaggerNodeFactory;var SwaggerVisitor=function(t){function e(e){var r=t.call(this)||this;return r.swaggerSpec=e,r}return __extends(e,t),e.prototype.visitEnterSwagger=function(t){},e.prototype.visitLeaveSwagger=function(t){},e.prototype.visitEnterSwaggerInfo=function(t){},e.prototype.visitLeaveSwaggerInfo=function(t){},e.prototype.visitEnterSwaggerPaths=function(t){},e.prototype.visitLeaveSwaggerPaths=function(t){},e.prototype.visitEnterSwaggerMethods=function(t){for(var e=["PUT","PATCH","POST","GET","DELETE"],r=0,o=t.getMethods();r<o.length;r++){var a=o[r];if(-1===e.indexOf(a.toUpperCase())){var i=new swagger_validation_error_1.SwaggerValidationError;i.name=a,i.addError("Unsupported Method ["+a.toUpperCase()+"] for the path [PATH_NAME]. Method will not be implemented. Supported methods are PUT, PATCH, POST, GET and DELETE"),t.errors.addChildError(i)}}},e.prototype.visitLeaveSwaggerMethods=function(t){},e.prototype.visitEnterSwaggerMethod=function(t,e){for(var r=[],o=[],a=[],i=0,n=t.getParameters();i<n.length;i++){var s=n[i];for(var d in s)s.hasOwnProperty(d)&&"in"===d&&("formData"===s[d]||("path"===s[d]?"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"integer"!==s.type&&"long"!==s.type&&o.indexOf(s.type)<0&&o.push(s.type):"query"===s[d]?"array"===s.type?"string"!==s.items.type&&"number"!==s.items.type&&"boolean"!==s.items.type&&"integer"!==s.items.type&&"long"!==s.items.type&&a.indexOf(s.items.type)<0&&a.push(s.items.type+":"+s.name):"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"integer"!==s.type&&"long"!==s.type&&a.indexOf(s.type)<0&&a.push(s.type+":"+s.name):"header"===s[d]&&("array"===s.type?"string"!==s.items.type&&"number"!==s.items.type&&"boolean"!==s.items.type&&"integer"!==s.items.type&&"long"!==s.items.type&&r.indexOf(s.items.type)<0&&r.push(s.items.type+":"+s.name):"string"!==s.type&&"number"!==s.type&&"boolean"!==s.type&&"integer"!==s.type&&"long"!==s.type&&r.indexOf(s.type)<0&&r.push(s.type+":"+s.name))))}if(r.length>0)for(var p=0;p<r.length;p++){var h=r[p].split(":"),g="";"array"===h[0]&&(g+="nested "+h[0]),t.errors.addError("Unsupported data type ["+g+"] in header parameter ["+h[1]+"] defined for method [METHOD_NAME] for the path [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type.")}if(o.length>0&&t.errors.addError("Unsupported data type ["+o+"] in path parameter [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type."),a.length>0)for(p=0;p<a.length;p++){var u=a[p].split(":"),c="";"array"===u[0]&&(c+="nested "+u[0]),t.errors.addError("Unsupported data type ["+c+"] in query parameter ["+u[1]+"] defined for method [METHOD_NAME] for the path [PATH_NAME]. Supported data types are string, integer, long, boolean. Unsupported data types will be converted to string data type.")}},e.prototype.visitLeaveSwaggerMethod=function(t){},e}(AbstractSwaggerNodeVisitor);exports.SwaggerVisitor=SwaggerVisitor;
//# sourceMappingURL=swagger-vistor.js.map
